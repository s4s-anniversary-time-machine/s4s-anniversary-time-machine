$={id:function(a){return document.getElementById(a)},cls:function(a,b){return(b||document).getElementsByClassName(a)},byName:function(a){return document.getElementsByName(a)},tag:function(a,b){return(b||document).getElementsByTagName(a)},qs:function(a,b){return(b||document).querySelector(a)},extend:function(a,b){for(var c in b)a[c]=b[c]}};document.documentElement.classList?($.hasClass=function(a,b){return a.classList.contains(b)},$.addClass=function(a,b){a.classList.add(b)},$.removeClass=function(a,b){a.classList.remove(b)}):($.hasClass=function(a,b){return-1!=(" "+a.className+" ").indexOf(" "+b+" ")},$.addClass=function(a,b){a.className=""==a.className?b:a.className+" "+b},$.removeClass=function(a,b){a.className=(" "+a.className+" ").replace(" "+b+" ","")});$.get=function(a,b,c){var d,e;e=new XMLHttpRequest;e.open("GET",a,!0);if(b)for(d in b)e[d]=b[d];if(c)for(d in c)e.setRequestHeader(d,c[d]);e.send(null);return e};$.hash=function(a){var b,c,d=0;b=0;for(c=a.length;b<c;++b)d=(d<<5)-d+a.charCodeAt(b);return d};$.cache={};var Parser={init:function(){var a,b,c,d;if(Config.filter||Config.embedSoundCloud||Config.embedYouTube)this.needMsg=!0;if(Config.imageSearch||Config.downloadFile)this.needFile=!0;a=2<=window.devicePixelRatio?"@2x.gif":".gif";this.icons={admin:"//static.4chan.org/image/adminicon"+a,mod:"//static.4chan.org/image/modicon"+a,dev:"//static.4chan.org/image/developericon"+a,del:"//static.4chan.org/image/filedeleted-res"+a};this.prettify="function"==typeof prettyPrint;this.customSpoiler={};Config.localTime&&(this.hasSeconds=(b=$.cls("dateTime")[1])&&/\d{2}:\d{2}:\d{2}$/.test(b.textContent),(a=(new Date).getTimezoneOffset())?(b=Math.abs(a),c=0|b/60,this.utcOffset=" UTC"+(0>a?"+":"-")+c+((d=b-60*c)?":"+d:"")):this.utcOffset=" UTC",this.weekdays="Sun Mon Tue Wed Thu Fri Sat".split(" "));Main.tid&&(this.trackedReplies=this.getTrackedReplies(Main.tid)||{})},getTrackedReplies:function(a){var b=null;if(b=sessionStorage.getItem("4chan-track-"+Main.board+"-"+a))b=JSON.parse(b);return b},saveTrackedReplies:function(a,b){sessionStorage.setItem("4chan-track-"+Main.board+"-"+a,JSON.stringify(b))},parseThreadJSON:function(a){var b;try{b=JSON.parse(a).posts}catch(c){console.log(c),b=[]}return b},parseCatalogJSON:function(a){var b;try{b=JSON.parse(a)}catch(c){console.log(c),b=[]}return b},setCustomSpoiler:function(a,b){var c;if(!this.customSpoiler[a]&&(b=parseInt(b)))this.customSpoiler[a]=a==Main.board&&(c=$.cls("imgspoiler")[0])?c.firstChild.src.match(/spoiler(-[a-z0-9]+)\.png$/)[1]:"-"+a+(Math.floor(Math.random()*b)+1)},buildPost:function(a,b,c){var d,e,f=null;for(d=0;e=a[d];++d)e.no==c&&(!Config.revealSpoilers&&a[0].custom_spoiler&&Parser.setCustomSpoiler(b,a[0].custom_spoiler),f=Parser.buildHTMLFromJSON(e,b).lastElementChild,Config.IDColor&&(IDColor.boards[b]&&(uid=$.cls("posteruid",f)[1]))&&IDColor.applyRemote(uid.firstElementChild));return f},buildHTMLFromJSON:function(a,b,c){var d=document.createElement("div"),e=!1,f="",g="",h="",h="",k,l="",m=f="",n="",p="",r="",q="",s="",t="",v,y="",z="",A="",u,w,B="",C,D="",x="reply",E="//images.4chan.org/"+b+"/src";0==a.resto&&(e=!0,c&&(D='<div class="postLink mobile"><span class="info"></span><a href="res/'+a.no+'" class="button">View Thread</a></div>',x="op",B=' &nbsp; <span>[<a href="res/'+a.no+'" class="replylink">Reply</a>]</span>'),a.resto=a.no);u=a.resto+"#p"+a.no;!Main.tid||b!=Main.board?(u="res/"+u,w="res/"+a.resto+"#q"+a.no):w="javascript:quote('"+a.no+"')";c=!a.capcode&&a.id?' <span class="posteruid id_'+a.id+'">(ID: <span class="hand" title="Highlight posts by this ID">'+
a.id+"</span>)</span> ":"";switch(a.capcode){case"admin_highlight":y=" highlightPost";case"admin":q=' <strong class="capcode hand id_admin"title="Highlight posts by the Administrator">## Admin</strong>';s=" capcodeAdmin";t=' <img src="'+Parser.icons.admin+'" alt="This user is the 4chan Administrator." title="This user is the 4chan Administrator." class="identityIcon">';break;case"mod":q=' <strong class="capcode hand id_mod" title="Highlight posts by Moderators">## Mod</strong>';s=" capcodeMod";t=' <img src="'+Parser.icons.mod+'" alt="This user is a 4chan Moderator." title="This user is a 4chan Moderator." class="identityIcon">';break;case"developer":q=' <strong class="capcode hand id_developer" title="Highlight posts by Developers">## Developer</strong>',s=" capcodeDeveloper",t=' <img src="'+Parser.icons.dev+'" alt="This user is a 4chan Developer." title="This user is a 4chan Developer." class="identityIcon">'}a.email&&(z='<a href="mailto:'+a.email.replace(/ /g,"%20")+'" class="useremail">',A="</a>");v=a.country?' <img src="//static.4chan.org/image/country/'+("pol"==b?"troll/":"")+a.country.toLowerCase()+'.gif" alt="'+a.country+'" title="'+a.country_name+'" class="countryFlag">':"";if(a.filedeleted)h='<div id="f'+a.no+'" class="file"><span class="fileThumb"><img src="'+Parser.icons.del+'" class="fileDeletedRes" alt="File deleted."></span></div>';else if(a.ext){n=p=a.filename+a.ext;if(a.filename.length>(e?40:30))n=a.filename.slice(0,e?35:25)+"(...)"+a.ext;!a.tn_w&&(!a.tn_h&&".gif"==a.ext)&&(a.tn_w=a.w,a.tn_h=a.h);f=1048576<=a.fsize?(0|100*(a.fsize/1048576)+0.5)/100+" M":1024<a.fsize?(0|a.fsize/1024+0.5)+" K":a.fsize+" ";a.spoiler?(l="Spoiler Image, "+f,Config.revealSpoilers||(m=" imgspoiler",k="//static.4chan.org/image/spoiler"+(Parser.customSpoiler[b]||"")+".png",a.tn_w=100,a.tn_h=100,C=!0)):l=f;k||(k="//thumbs.4chan.org/"+b+"/thumb/"+a.tim+"s.jpg");"f"!=b?(h=E+"/"+a.tim+a.ext,g='<a class="fileThumb'+m+'" href="'+h+'" target="_blank"><img src="'+k+'" alt="'+l+'B" data-md5="'+a.md5+'" style="height: '+a.tn_h+"px; width: "+a.tn_w+'px;"><div class="mFileInfo mobile">'+f+"B "+a.ext.slice(1).toUpperCase()+"</div></a>"):h=E+"/"+a.filename+a.ext;f=".pdf"==a.ext?"PDF":a.w+"x"+a.h;h='<span class="fileText" id="fT'+a.no+(a.spoiler?'" title="'+p+'"':'"')+'>File: <a href="'+h+'" target="_blank">'+a.tim+a.ext+"</a>-("+l+"B, "+f+(C?"":', <span title="'+p+'">'+n+"</span>")+")</span>";h='<div id="f'+a.no+'" class="file">'+(h?'<div class="fileInfo">':"")+h+(h?"</div>":"")+g+"</div>"}a.trip&&(r=' <span class="postertrip">'+a.trip+"</span>");g=a.name||"";k=a.sub||"";d.className="postContainer "+x+"Container";d.id="pc"+a.no;d.innerHTML=(e?"":'<div class="sideArrows" id="sa'+a.no+'">&gt;&gt;</div>')+'<div id="p'+a.no+'" class="post '+x+y+'"><div class="postInfoM mobile" id="pim'+a.no+'"><span class="nameBlock'+s+'"><span class="name">'+g+"</span>"+r+q+t+c+v+'<br><span class="subject">'+k+'</span></span><span class="dateTime postNum" data-utc="'+a.time+'">'+a.now+' <a href="'+a.no+"#p"+a.no+'">No.</a><a href="javascript:quote(\''+a.no+'\');" title="Quote this post">'+a.no+"</a></span></div>"+(e?h:"")+'<div class="postInfo desktop" id="pi'+a.no+'"><input type="checkbox" name="'+a.no+'" value="delete"> <span class="subject">'+k+'</span> <span class="nameBlock'+s+'">'+z+'<span class="name">'+g+"</span>"+r+q+A+t+c+v+' </span> <span class="dateTime" data-utc="'+a.time+'">'+a.now+'</span> <span class="postNum desktop"><a href="'+u+'" title="Highlight this post">No.</a><a href="'+w+'" title="Quote this post">'+
a.no+"</a>"+B+"</span></div>"+(e?"":h)+'<blockquote class="postMessage" id="m'+a.no+'">'+(a.com||"")+"</blockquote> </div>"+D;if(!Main.tid||b!=Main.board){q=d.getElementsByClassName("quotelink");for(a=0;e=q[a];++a)r=e.getAttribute("href"),"/"!=r.charAt(0)&&(e.href="/"+b+"/res/"+r)}return d},parseBoard:function(){var a,b=document.getElementsByClassName("thread");for(a=0;b[a];++a)Parser.parseThread(b[a].id.slice(1))},parseThread:function(a,b,c){var d,e,f,g,h,k;f=$.id("t"+a);g=f.getElementsByClassName("post");if(!b){d=document.getElementById("pi"+a);if(!Main.tid&&(Config.filter&&(e=Filter.exec(f,d,document.getElementById("m"+a),a)),Config.threadHiding&&!e&&(Main.hasMobileLayout?(e=document.createElement("a"),e.href="javascript:;",e.setAttribute("data-cmd","hide"),e.setAttribute("data-id",a),e.className="mobileHideButton button",e.textContent="Hide",g[0].nextElementSibling.appendChild(e)):(e=document.createElement("span"),e.innerHTML='<img alt="H" class="extButton threadHideButton"data-cmd="hide" data-id="'+
a+'" src="'+Main.icons.minus+'" title="Toggle thread">',g[0].insertBefore(e,g[0].firstChild)),e.id="sa"+a,ThreadHiding.hidden[a]&&(ThreadHiding.hidden[a]=Main.now,ThreadHiding.hide(a))),ThreadExpansion.enabled&&(h=$.cls("summary",f)[0])))f=document.createDocumentFragment(),k=h.cloneNode(!0),k.className="",h.textContent="",e=document.createElement("img"),e.className="extButton expbtn",e.title="Expand thread",e.alt="+",e.setAttribute("data-cmd","expand"),e.setAttribute("data-id",a),e.src=Main.icons.plus,f.appendChild(e),f.appendChild(k),e=document.createElement("span"),e.style.display="none",e.textContent="Showing all replies.",f.appendChild(e),h.appendChild(f);Config.threadWatcher&&(e=document.createElement("img"),e.className="extButton wbtn",ThreadWatcher.watched[h=a+"-"+Main.board]?(e.src=Main.icons.watched,e.setAttribute("data-active","1")):e.src=Main.icons.notwatched,e.id="wbtn-"+h,e.setAttribute("data-cmd","watch"),e.setAttribute("data-id",a),e.alt="W",e.title="Add to watch list",d.insertBefore(e,d.firstChild))}e=b?0>b?g.length+b:b:0;c=c?e+c:g.length;if(Main.isMobileDevice&&Config.quotePreview)for(d=e;d<c;++d)Parser.parseMobileQuotelinks(g[d]);if(Parser.trackedReplies)for(d=e;d<c;++d)Parser.parseTrackedReplies(g[d]);for(d=e;d<c;++d)Parser.parsePost(g[d].id.slice(1),a);if(b){if(Parser.prettify)for(d=e;d<c;++d)Parser.parseMarkup(g[d]);if(window.jsMath)if(window.jsMath.loaded)for(d=e;d<c;++d)window.jsMath.ProcessBeforeShowing(g[d]);else Parser.loadJSMath()}UA.dispatchEvent("4chanParsingDone",{threadId:a,offset:e,limit:c})},loadJSMath:function(a){$.cls("math",a)[0]&&(window.jsMath.Autoload.Script.Push("ProcessBeforeShowing",[null]),window.jsMath.Autoload.LoadJsMath())},parseMathOne:function(a){window.jsMath.loaded?window.jsMath.ProcessBeforeShowing(a):Parser.loadJSMath(a)},parseTrackedReplies:function(a){var b,c;c=$.cls("quotelink",a);for(a=0;b=c[a];++a)Parser.trackedReplies[b.textContent]&&(b.textContent+=" (You)",Parser.hasYouMarkers=!0)},parseMobileQuotelinks:function(a){var b,c,d;c=$.cls("quotelink",a);for(a=0;b=c[a];++a)if(d=b.getAttribute("href").match(/^(?:\/([^\/]+)\/)?(?:res\/)?([0-9]+)?#p([0-9]+)$/))d=document.createElement("a"),d.href=b.href,d.textContent=" #",d.className="quoteLink",b.parentNode.insertBefore(d,b.nextSibling)},parseMarkup:function(a){var b,c;if((b=a.getElementsByClassName("prettyprint"))[0])for(a=0;c=b[a];++a)c.innerHTML=prettyPrintOne(c.innerHTML)},parsePost:function(a,b){var c,d,e,f,g,h,k,l;if(b){e=document.getElementById("pi"+a);Parser.needMsg&&(f=document.getElementById("m"+a));k="";Config.reportButton&&(Main.hasMobileLayout?(d=document.createElement("span"),d.className="mobile mobile-report",d.setAttribute("data-cmd","report"),d.setAttribute("data-id",a),d.textContent="Report",e.parentNode.appendChild(d)):k+='<img class="extButton" alt="!" data-cmd="report" data-id="'+a+'" src="'+Main.icons.report+'" title="Report">');k&&(c=document.createElement("div"),c.className="extControls",c.innerHTML=k,e.appendChild(c));if(Parser.needFile&&(g=document.getElementById("fT"+
a)))k="",Config.downloadFile&&(c=((d=g.children[1])?d:g).getAttribute("title"),k+='<a href="'+g.firstElementChild.href+'" download="'+c+'" title="Download file"><img class="extButton" src="'+Main.icons.download+'" alt="D"></a>'),Config.imageSearch&&(c=g.firstElementChild.href,k+='<a href="//www.google.com/searchbyimage?image_url='+c+'" target="_blank" title="Google Image Search"><img class="extButton" src="'+Main.icons.gis+'" alt="G"></a><a href="http://iqdb.org/?url='+c+'" target="_blank" title="iqdb"><img class="extButton" src="'+
Main.icons.iqdb+'" alt="I"></a>'),k&&(c=document.createElement("div"),c.className="extControls",c.innerHTML=k,g.parentNode.appendChild(c));a!=b&&(Config.filter&&(h=Filter.exec(e.parentNode,e,f)),Config.replyHiding&&!h&&(d=document.getElementById("sa"+a),d.innerHTML='<img class="extButton replyHideButton" data-cmd="hide-r" data-id="'+a+'" src="'+Main.icons.minus+'" title="Toggle reply">',ReplyHiding.hidden[a]&&(ReplyHiding.hidden[a]=Main.now,ReplyHiding.hide(a))),Config.backlinks&&Parser.parseBacklinks(a,b));IDColor.enabled&&(l=$.cls("posteruid",e)[0])&&IDColor.apply(l.firstElementChild);Config.embedSoundCloud&&Media.parseSoundCloud(f);Config.embedYouTube&&Media.parseYouTube(f)}else e=a.getElementsByClassName("postInfo")[0],a=e.id.slice(2);if(Config.revealSpoilers&&((g=document.getElementById("f"+a))&&(g=g.children[1]))&&$.hasClass(g,"imgspoiler"))f=g.firstChild,g.removeChild(f),f.removeAttribute("style"),c=$.hasClass(e.parentNode,"op"),f.style.maxWidth=f.style.maxHeight=c?"250px":"125px",f.src="//thumbs.4chan.org"+
g.pathname.replace(/src(\/[0-9]+).+$/,"thumb$1s.jpg"),h=g.previousElementSibling.firstElementChild,k=h.title.split("."),c=k[0].length>(c?40:30)?k[0].slice(0,c?35:25)+"(...)"+k[1]:h.title,h.lastChild.textContent=h.lastChild.textContent.slice(0,-1)+", "+c+")",g.insertBefore(f,g.firstElementChild);Config.localTime&&(d=e.getElementsByClassName("dateTime")[0],d.textContent=Parser.getLocaleDate(new Date(1E3*d.getAttribute("data-utc")))+this.utcOffset)},getLocaleDate:function(a){return("0"+(1+a.getMonth())).slice(-2)+"/"+("0"+a.getDate()).slice(-2)+"/"+("0"+a.getFullYear()).slice(-2)+"("+this.weekdays[a.getDay()]+")"+("0"+a.getHours()).slice(-2)+":"+("0"+a.getMinutes()).slice(-2)+(this.hasSeconds?":"+("0"+a.getSeconds()).slice(-2):"")},parseBacklinks:function(a,b){var c,d,e,f,g,h,k;if(e=document.getElementById("m"+a).getElementsByClassName("quotelink")){f={};for(c=0;d=e[c];++c)if(g=d.getAttribute("href").split("#p"),g[1])if(g[1]==b&&(d.textContent+=" (OP)"),h=document.getElementById("pi"+g[1])){if(!f[g[1]]){f[g[1]]=!0;d=document.createElement("span");d.innerHTML='<a href="#p'+a+'" class="quotelink">&gt;&gt;'+a+"</a> ";if(!(k=document.getElementById("bl_"+g[1])))k=document.createElement("div"),k.id="bl_"+g[1],k.className="backlink",k.innerHTML="Replies: ",h.appendChild(k);k.appendChild(d)}}else Main.tid&&"/"!=g[0].charAt(0)&&(d.textContent+=" \u2192")}},buildSummary:function(a,b,c){if(b)b=b+" post"+(1<b?"s":"");else return null;c=c?" and "+c+" image repl"+(1<c?"ies":"y"):"";el=document.createElement("span");el.className="summary desktop";el.innerHTML=b+c+' omitted. Click <a href="res/'+a+'" class="replylink">here</a> to view.';return el}},Depager={init:function(){var a,b;this.threadsLoaded=this.isComplete=this.isEnabled=this.isLoading=!1;this.threadQueue=[];this.debounce=100;this.threshold=350;this.adId="azk53379";this.adZones=[16258,16260];this.boardHasAds=!!$.id(this.adId)&&window.ados_load;if(a=$.cls("prev")[0])if(a.innerHTML='[<a title="Toggle infinite scroll" class="depagelink" href="" data-cmd="depage">All</a>]',a=a.firstElementChild,Config.alwaysDepage){if(this.isEnabled=!0,a.parentNode.parentNode.className+=" depagerEnabled",Depager.bindHandlers(),b=$.cls("board")[0])a=document.createElement("span"),a.className="depageNumber",a.textContent="[Page 0]",b.insertBefore(a,b.firstElementChild)}else a.setAttribute("data-cmd","depage")},onScroll:function(){document.documentElement.scrollHeight<=window.innerHeight+window.pageYOffset+Depager.threshold&&(Depager.threadsLoaded?Depager.renderNext():Depager.depage())},trackPageview:function(a){window._gat&&(a="/"+Main.board+"/"+a,window._gat._getTrackerByName()._trackPageview(a));window.__qc&&(window.__qc.qpixelsent=[],window._qevents.push({qacct:window.__qc.qopts.qacct}),window.__qc.firepixels())},insertAd:function(a,b,c,d){var e;Depager.boardHasAds&&(d?(b=$.cls("bottomad"),d=b[b.length-1],e=document.createElement("div"),e.id="azkDepage"+a,d.appendChild(e),window.ados_add_placement(3536,18130,e.id,4).setZone(c)):(d=document.createElement("div"),d.className="bottomad center",1==a?e=$.id(Depager.adId):(e=document.createElement("div"),e.id="azkDepage"+a),d.appendChild(e),b.appendChild(d),b.appendChild(document.createElement("hr")),1!=a&&window.ados_add_placement(3536,18130,e.id,4).setZone(c)))},renderNext:function(){var a,b,c,d,e,f,g,h,k,l,m,n;k=[];l=window.pageYOffset;b=document.createDocumentFragment();if(a=Depager.threadQueue.shift()){e=a.threads;m=a.page;n=!Depager.threadQueue.length;Depager.insertAd(m,b,a.adZone,n);a=document.createElement("span");a.className="depageNumber";a.textContent="[Page "+m+"]";b.appendChild(a);for(c=0;a=e[c];++c)if(!$.id("t"+a.no)){g=document.createElement("div");g.id="t"+a.no;g.className="thread";g.appendChild(Parser.buildHTMLFromJSON(a,Main.board,!0));(f=Parser.buildSummary(a.no,a.omitted_posts,a.omitted_images))&&g.appendChild(f);if(a.replies){last_replies=a.last_replies;for(d=0;h=last_replies[d];++d)g.appendChild(Parser.buildHTMLFromJSON(h,Main.board))}b.appendChild(g);b.appendChild(document.createElement("hr"));k.push(a.no)}n&&(Depager.unbindHandlers(),Depager.isComplete=!0,Depager.setStatus("disabled"));boardDiv=$.cls("board")[0];boardDiv.insertBefore(b,boardDiv.lastElementChild);Depager.trackPageview(m);Depager.boardHasAds&&window.ados_load();for(b=0;a=k[b];++b)Parser.parseThread(a);window.scrollTo(0,l)}},bindHandlers:function(){window.addEventListener("scroll",Depager.onScroll,!1);window.addEventListener("resize",Depager.onScroll,!1)},unbindHandlers:function(){window.removeEventListener("scroll",Depager.onScroll,!1);window.removeEventListener("resize",Depager.onScroll,!1)},setStatus:function(a){var b,c;c=$.cls("depagelink");if(c.length)if("enabled"==a)for(a=0;b=c[a];++a)b.textContent="All",b=b.parentNode.parentNode,$.hasClass(b,"depagerEnabled")||$.addClass(b,"depagerEnabled");else if("loading"==a)for(a=0;b=c[a];++a)b.textContent="Loading\u2026";else if("disabled"==a)for(a=0;b=c[a];++a)b.textContent="All",$.removeClass(b.parentNode.parentNode,"depagerEnabled");else if("error"==a)for(a=0;b=c[a];++a)b.textContent="Error",b.removeAttribute("title"),b.removeAttribute("data-cmd"),$.removeClass(b.parentNode.parentNode,"depagerEnabled")},toggle:function(){!Depager.isLoading&&!Depager.isComplete&&(Depager.isEnabled?Depager.disable():Depager.enable(),Depager.isEnabled=!Depager.isEnabled)},enable:function(){Depager.bindHandlers();Depager.setStatus("enabled");Depager.onScroll()},disable:function(){Depager.unbindHandlers();Depager.setStatus("disabled")},depage:function(){Depager.isLoading||(Depager.isLoading=!0,$.get("//api.4chan.org/"+Main.board+"/catalog.json",{onload:Depager.onLoad,onerror:Depager.onError}),Depager.setStatus("loading"))},onLoad:function(){var a,b,c,d,e;Depager.isLoading=!1;Depager.threadsLoaded=!0;if(200==this.status){Depager.setStatus("enabled");Config.alwaysDepage||Depager.bindHandlers();a=Parser.parseCatalogJSON(this.responseText);d=Depager.threadQueue;e=0;for(b=1;c=a[b];++b)c.adZone=e,d.push(c),e=e?0:1;Depager.renderNext()}else 404==this.status?Depager.unbindHandlers():(Depager.unbindHandlers(),console.log("Error: "+this.status)),Depager.setStatus("error")},onError:function(){Depager.isLoading=!1;Depager.unbindHandlers();console.log("Error: "+this.status);Depager.setStatus("error")}},QuoteInline={isSelfQuote:function(a,b,c){if(c&&c!=Main.board)return!1;a=a.parentNode;return"BLOCKQUOTE"==a.nodeName&&a.id.split("m")[1]==b||a.parentNode.id.split("_")[1]==b?!0:!1},toggle:function(a,b){var c,d,e;if((c=a.getAttribute("href").match(/^(?:\/([^\/]+)\/)?(?:res\/)?([0-9]+)?#p([0-9]+)$/))&&!("rs"==c[1]||QuoteInline.isSelfQuote(a,c[3],c[1])))b&&b.preventDefault(),(d=a.getAttribute("data-pfx"))?(a.removeAttribute("data-pfx"),$.removeClass(a,"linkfade"),d=$.id(d+"p"+c[3]),d.parentNode.removeChild(d),"backlink"==a.parentNode.parentNode.className&&(d=$.id("pc"+c[3]),c=+d.getAttribute("data-inline-count")-1,0==c?(d.style.display="",d.removeAttribute("data-inline-count")):d.setAttribute("data-inline-count",c))):(e=$.id("p"+c[3]))?QuoteInline.inline(a,e,c[3]):QuoteInline.inlineRemote(a,c[1]||Main.board,c[2],c[3])},inlineRemote:function(a,b,c,d){var e,f,g,h;a.hasAttribute("data-loading")||(g=b+"-"+c,(e=$.cache[g])&&(f=Parser.buildPost(e,b,d))?QuoteInline.inline(a,f):(h=a.nextElementSibling)&&$.hasClass(h,"spinner")?h.parentNode.removeChild(h):(h=document.createElement("div"),h.className="preview spinner inlined",h.textContent="Loading...",a.parentNode.insertBefore(h,a.nextSibling),e=function(){var c;a.removeAttribute("data-loading");if(200==this.status||304==this.status||0==this.status)c=Parser.parseThreadJSON(this.responseText),$.cache[g]=c,(c=Parser.buildPost(c,b,d))?(h.parentNode&&h.parentNode.removeChild(h),QuoteInline.inline(a,c)):($.addClass(a,"deadlink"),h.textContent="This post doesn't exist anymore");else if(404==this.status)$.addClass(a,"deadlink"),h.textContent="This thread doesn't exist anymore";else this.onerror()},f=function(){h.textContent="Error: "+this.statusText+" ("+this.status+")";a.removeAttribute("data-loading")},a.setAttribute("data-loading","1"),$.get("//api.4chan.org/"+b+"/res/"+c+".json",{onload:e,onerror:f})))},inline:function(a,b,c){var d,e,f,g,h,k;e=Date.now();if(c){"backlink"==(g=a.parentNode.parentNode).className?(f=g.parentNode.parentNode.parentNode,h=!0):f=g.parentNode;for(;f.parentNode!==document;){if(f.id.split("m")[1]==c)return;f=f.parentNode}}a.className+=" linkfade";a.setAttribute("data-pfx",e);f=b.cloneNode(!0);f.id=e+f.id;f.setAttribute("data-pfx",e);f.className+=" preview inlined";$.removeClass(f,"highlight");$.removeClass(f,"highlight-anti");if((k=$.cls("inlined",f))[0]){for(;d=k[0];)d.parentNode.removeChild(d);k=$.cls("quotelink",f);for(c=0;d=k[c];++c)d.removeAttribute("data-pfx"),$.removeClass(d,"linkfade")}for(c=0;d=f.children[c];++c)d.id=e+d.id;if(c=$.cls("backlink",f)[0])c.id=e+c.id;h?(a=g.parentNode.parentNode.getAttribute("data-pfx")||"",a=$.id(a+"m"+g.id.split("_")[1]),a.insertBefore(f,a.firstChild),(f=b.parentNode.getAttribute("data-inline-count"))?f=+f+1:(f=1,b.parentNode.style.display="none"),b.parentNode.setAttribute("data-inline-count",f)):($.hasClass(a.parentNode,"quote")&&(a=a.parentNode),b=a.parentNode,b.insertBefore(f,a.nextSibling))}},QuotePreview={init:function(){this.regex=/^(?:\/([^\/]+)\/)?(?:res\/)?([0-9]+)?#p([0-9]+)$/;this.debounce=200;this.highlightAnti=this.highlight=this.timeout=null;this.out=!0},resolve:function(a){var b,c,d;b=QuotePreview;b.out=!1;if((c=a.getAttribute("href").match(b.regex))&&"rs"!=c[1])(d=document.getElementById("p"+c[3]))?(c=d.getBoundingClientRect(),0<c.top&&c.bottom<document.documentElement.clientHeight&&!$.hasClass(d.parentNode,"post-hidden")?!$.hasClass(d,"highlight")&&location.hash.slice(1)!=d.id?(b.highlight=d,$.addClass(d,"highlight")):$.hasClass(d,"op")||(b.highlightAnti=d,$.addClass(d,"highlight-anti")):b.show(a,d)):UA.hasCORS&&(Main.isMobileDevice?b.showRemote(a,c[1]||Main.board,c[2],c[3]):b.timeout=setTimeout(b.showRemote,b.debounce,a,c[1]||Main.board,c[2],c[3]))},showRemote:function(a,b,c,d){var e,f,g;g=b+"-"+c;(f=$.cache[g])&&(e=Parser.buildPost(f,b,d))?QuotePreview.show(a,e):(a.style.cursor="wait",$.get("//api.4chan.org/"+b+"/res/"+c+".json",{onload:function(){var c;a.style.cursor="";200==this.status||304==this.status||0==this.status?(c=Parser.parseThreadJSON(this.responseText),$.cache[g]=c,!$.id("quote-preview")&&!QuotePreview.out&&((c=Parser.buildPost(c,b,d))?(c.className="post preview",c.style.display="none",c.id="quote-preview",document.body.appendChild(c),QuotePreview.show(a,c,!0)):$.addClass(a,"deadlink"))):404==this.status&&$.addClass(a,"deadlink")},onerror:function(){a.style.cursor=""}}))},show:function(a,b,c){var d,e,f;c?(Parser.parsePost(b),b.style.display=""):(b=b.cloneNode(!0),location.hash&&location.hash=="#"+b.id&&(b.className+=" highlight"),b.id="quote-preview",b.className+=" preview",Config.imageExpansion&&(e=$.cls("expanded-thumb",b)[0])&&ImageExpansion.contract(e));if(!a.parentNode.className&&(c=b.querySelectorAll("#"+$.cls("postMessage",b)[0].id+" > .quotelink"),c[1])){f=">>"+a.parentNode.parentNode.id.split("_")[1];for(e=0;d=c[e];++e)if(d.textContent==f){$.addClass(d,"dotted");break}}d=a.getBoundingClientRect();e=document.documentElement;f=e.offsetWidth;c=b.style;document.body.appendChild(b);Main.isMobileDevice?(c.top=d.top+a.offsetHeight+window.pageYOffset+"px",c.left=d.left+"px",b=b.offsetWidth-f+d.left,0<b&&(c.marginLeft=-b+"px")):(f-d.right<(0|0.3*f)?(f-=d.left,c.right=f+5+"px"):(f=d.left+d.width,c.left=f+5+"px"),a=d.top+a.offsetHeight+window.pageYOffset-b.offsetHeight/2-d.height/2,b=b.getBoundingClientRect().height,d=e.scrollTop!=document.body.scrollTop?e.scrollTop+document.body.scrollTop:document.body.scrollTop,c.top=a<d?d+"px":a+b>d+e.clientHeight?d+e.clientHeight-b+"px":a+"px")},remove:function(a){var b,c;b=QuotePreview;b.out=!0;b.highlight?($.removeClass(b.highlight,"highlight"),b.highlight=null):b.highlightAnti&&($.removeClass(b.highlightAnti,"highlight-anti"),b.highlightAnti=null);clearTimeout(b.timeout);a&&(a.style.cursor="");(c=$.id("quote-preview"))&&document.body.removeChild(c)}},ImageExpansion={expand:function(a){var b,c;Config.imageHover&&(b=$.id("image-hover"))&&document.body.removeChild(b);c=a.parentNode.getAttribute("href");if("pdf"!=c.slice(-3))if(a.setAttribute("data-expanding","1"),b=document.createElement("img"),b.alt="Image",b.setAttribute("src",c),b.className="expanded-thumb",b.style.display="none",b.onerror=this.onError,a.parentNode.insertBefore(b,a.nextElementSibling),UA.hasCORS)a.style.opacity="0.75",this.timeout=this.checkLoadStart(b,a);else this.onLoadStart(b,a)},contract:function(a){var b,c;clearTimeout(this.timeout);c=a.parentNode;b=c.parentNode.parentNode;$.removeClass(c.parentNode,"image-expanded");!Main.tid&&Config.threadHiding&&$.removeClass(c,"image-expanded-anti");c.firstChild.style.display="";c.removeChild(a);b.offsetTop<window.pageYOffset&&b.scrollIntoView()},toggle:function(a){a.hasAttribute("data-md5")?a.hasAttribute("data-expanding")||ImageExpansion.expand(a):ImageExpansion.contract(a)},onError:function(a){var b;b=a.target;a=$.qs("img[data-expanding]",b.parentNode);b.parentNode.removeChild(b);a.style.opacity="";a.removeAttribute("data-expanding")},onLoadStart:function(a,b){var c,d,e,f,g;b.removeAttribute("data-expanding");c=b.getBoundingClientRect().left;e=document.documentElement.clientWidth-2*c;f=document.documentElement.clientHeight;c=a.naturalWidth;d=a.naturalHeight;c>e&&(g=e/c,c=e,d*=g);Config.fitToScreenExpansion&&d>f&&(g=f/d,d=f,c*=g);a.style.maxWidth=c+"px";a.style.maxHeight=d+"px";$.addClass(b.parentNode.parentNode,"image-expanded");!Main.tid&&Config.threadHiding&&$.addClass(b.parentNode,"image-expanded-anti");a.style.display="";b.style.display="none"},checkLoadStart:function(a,b){if(a.naturalWidth)ImageExpansion.onLoadStart(a,b),b.style.opacity="";else return setTimeout(ImageExpansion.checkLoadStart,15,a,b)}},ImageHover={show:function(a){var b,c;c=a.parentNode.getAttribute("href");"pdf"!=c.slice(-3)&&(b=document.createElement("img"),b.id="image-hover",b.alt="Image",b.setAttribute("src",c),document.body.appendChild(b),UA.hasCORS?(b.style.display="none",this.timeout=ImageHover.checkLoadStart(b,a)):b.style.left=a.getBoundingClientRect().right+10+"px")},hide:function(){var a;clearTimeout(this.timeout);(a=$.id("image-hover"))&&document.body.removeChild(a)},onLoadStart:function(a,b){var c;c=b.getBoundingClientRect();c=window.innerWidth-c.right;a.naturalWidth>c&&(a.style.maxWidth=c-20+"px");a.style.display=""},checkLoadStart:function(a,b){if(a.naturalWidth)ImageHover.onLoadStart(a,b);else return setTimeout(ImageHover.checkLoadStart,15,a,b)}},QR={init:function(){UA.hasFormData&&(this.enabled=!0,this.timestamp=this.cooldown=this.currentTid=null,this.auto=!1,this.comField=this.btn=null,this.comLength=window.comlen,this.lenCheckTimeout=null,this.sagePost=2,this.filePost=4,this.activeDelay=this.cdType=this.cdElapsed=0,"q"==Main.board?(this.baseDelay=150500,this.fileDelay=300500,this.sageDelay=600500):(this.fileDelay=this.baseDelay=30500,this.sageDelay=60500),this.captchaDelay=240500,this.dndFile=this.banXhr=this.xhr=this.pulse=this.captchaInterval=null,this.fileDisabled=!!window.imagelimit,this.tracked={},QR.purgeCooldown(),UA.hasDragAndDrop&&(document.addEventListener("drop",QR.onDrop,!1),document.addEventListener("dragover",QR.onDragOver,!1),document.addEventListener("dragstart",QR.toggleDropHandlers,!1),document.addEventListener("dragend",QR.toggleDropHandlers,!1)),window.addEventListener("storage",this.syncStorage,!1))},lock:function(){QR.showPostError("This thread is closed.","closed",!0)},unlock:function(){QR.hidePostError("closed")},syncStorage:function(a){var b;a.key&&(b=a.key.split("-"),"4chan"==b[0]&&("cd"==b[1]&&a.newValue&&Main.board==b[2])&&QR.startCooldown(a.newValue))},quotePost:function(a,b){!QR.noCooldown&&(Main.threadClosed||!Main.tid&&Main.isThreadClosed(a))?alert("Thread closed. You may not reply at this time."):(QR.show(a),QR.addQuote(b))},addQuote:function(a){var b,c,d;d=$.tag("textarea",document.forms.qrPost)[0];b=d.selectionStart;c=UA.getSelection();a=a?">>"+a+"\n":"";c&&(a+=">"+c.trim().replace(/[\r\n]+/g,"\n>")+"\n");d.value=d.value?d.value.slice(0,b)+a+d.value.slice(d.selectionEnd):a;UA.isOpera&&(b+=a.split("\n").length);d.selectionStart=d.selectionEnd=b+a.length;d.selectionStart==d.value.length&&(d.scrollTop=d.scrollHeight);d.focus()},show:function(a){var b,c,d,e,f,g,h,k,l,m,n,p;if(QR.currentTid)!Main.tid&&QR.currentTid!=a&&($.id("qrTid").textContent=$.id("qrResto").value=QR.currentTid=a,$.byName("com")[1].value=""),Main.hasMobileLayout&&($.id("quickReply").style.top=window.pageYOffset+25+"px");else{QR.currentTid=a;e=$.id("postForm");d=document.createElement("div");d.id="quickReply";d.className="extPanel reply";d.setAttribute("data-trackpos","QR-position");Main.hasMobileLayout?d.style.top=window.pageYOffset+
28+"px":Config["QR-position"]?d.style.cssText=Config["QR-position"]:(d.style.right="0px",d.style.top="10%");d.innerHTML='<div id="qrHeader" class="drag postblock">Quick Reply - Thread No.<span id="qrTid">'+a+'</span><img alt="X" src="'+Main.icons.cross+'" id="qrClose" class="extButton" title="Close Window"></div>';f=e.parentNode.cloneNode(!1);f.setAttribute("name","qrPost");f.innerHTML='<input type="hidden" value="'+$.byName("MAX_FILE_SIZE")[0].value+'" name="MAX_FILE_SIZE"><input type="hidden" value="regist" name="mode"><input id="qrResto" type="hidden" value="'+
a+'" name="resto">';a=document.createElement("div");a.id="qrForm";g=e.firstElementChild.children;b=0;for(c=g.length-1;b<c;++b){h=document.createElement("div");if("captchaFormPart"==g[b].id){if(QR.noCaptcha)continue;h.innerHTML='<img id="qrCaptcha" title="Reload" width="300" height="57" src="'+$.id("recaptcha_image").firstChild.src+'" alt="reCAPTCHA challenge image"><input id="qrCapField" name="recaptcha_response_field" placeholder="reCAPTCHA Challenge (Required)" type="text" autocomplete="off" autocorrect="off" autocapitalize="off"><input id="qrChallenge" name="recaptcha_challenge_field" type="hidden" value="'+
$.id("recaptcha_challenge_field").value+'">'}else if(m=g[b].firstElementChild.textContent,"Password"==m||"Spoilers"==m)continue;else if("File"==m)k=g[b].children[1].firstChild.cloneNode(!1),k.id="qrFile",k.size="19",k.addEventListener("change",QR.onFileChange,!1),h.appendChild(k),UA.hasDragAndDrop&&($.addClass(k,"qrRealFile"),k=document.createElement("div"),k.id="qrDummyFile",l=document.createElement("button"),l.id="qrDummyFileButton",l.type="button",l.textContent="Browse\u2026",k.appendChild(l),l=document.createElement("span"),l.id="qrDummyFileLabel",l.textContent="No file selected.",k.appendChild(l),h.appendChild(k)),k.title="Shift + Click to remove the file";else if(h.innerHTML=g[b].children[1].innerHTML,l="hidden"==h.firstChild.type?h.lastChild.previousSibling:h.firstChild,"INPUT"==l.nodeName||"TEXTAREA"==l.nodeName){if("name"==l.name){if(QR.noCaptcha&&(l.tabIndex=1),p=Main.getCookie("4chan_name"))l.value=p}else if("email"==l.name){if(QR.noCaptcha&&(l.tabIndex=2),l.id="qrEmail",l.addEventListener("change",QR.checkCDType,!1),p=Main.getCookie("4chan_email"))l.value=p}else"sub"==l.name?QR.noCaptcha&&(l.tabIndex=3):"com"==l.name&&(QR.noCaptcha&&(l.tabIndex=4),QR.comField=l,l.addEventListener("keydown",QR.onKeyDown,!1),l.addEventListener("paste",QR.onKeyDown,!1),l.addEventListener("cut",QR.onKeyDown,!1),h.children[1]&&h.removeChild(l.nextSibling));l.setAttribute("placeholder",m)}a.appendChild(h)}this.btn=a.querySelector('input[type="submit"]');this.btn.previousSibling.className="presubmit";QR.noCaptcha&&(this.btn.tabIndex=5)&&(k.tabIndex=5);e.querySelector('input[name="spoiler"]')&&(e=document.createElement("span"),e.id="qrSpoiler",e.innerHTML='<label>[<input type="checkbox" value="on" name="spoiler">Spoiler?]</label>',k.parentNode.insertBefore(e,k.nextSibling));f.appendChild(a);d.appendChild(f);f=document.createElement("div");f.id="qrError";d.appendChild(f);d.addEventListener("click",QR.onClick,!1);document.body.appendChild(d);(n=localStorage.getItem("4chan-cd-"+Main.board))&&QR.startCooldown(n);Main.threadClosed&&QR.lock();QR.reloadCaptcha();Main.hasMobileLayout||Draggable.set($.id("qrHeader"))}},onFileChange:function(){this.value&&QR.fileDisabled?QR.showPostError("Image limit reached.","imagelimit",!0):QR.hidePostError();UA.hasDragAndDrop&&(QR.dndFile=null,$.id("qrDummyFileLabel").textContent=this.files[0].name);QR.checkCDType()},onKeyDown:function(a){if(a.ctrlKey&&83==a.keyCode){var b,c,d;a.stopPropagation();a.preventDefault();a=a.target;b=a.selectionStart;c=a.selectionEnd;a.value?(d="[spoiler]"+a.value.slice(b,c)+"[/spoiler]",a.value=a.value.slice(0,b)+d+a.value.slice(c),a.setSelectionRange(c+19,c+19)):(a.value="[spoiler][/spoiler]",a.setSelectionRange(9,9))}else if(27==a.keyCode&&!a.ctrlKey&&!a.altKey&&!a.shiftKey&&!a.metaKey){QR.close();return}clearTimeout(QR.lenCheckTimeout);QR.lenCheckTimeout=setTimeout(QR.checkComLength,500)},checkComLength:function(){var a;QR.comLength&&(a=encodeURIComponent(QR.comField.value).split(/%..|./).length-1,a>QR.comLength?QR.showPostError("Comment too long ("+
a+"/"+QR.comLength+")","length"):QR.hidePostError("length"))},close:function(){var a,b=$.id("quickReply");QR.comField=null;QR.currentTid=null;clearInterval(QR.captchaInterval);clearInterval(QR.pulse);QR.xhr&&(QR.xhr.abort(),QR.xhr=null);QR.banXhr&&(QR.banXhr.abort(),QR.banXhr=null);b.removeEventListener("click",QR.onClick,!1);(a=$.id("qrFile"))&&a.removeEventListener("change",QR.checkCDType,!1);(a=$.id("qrEmail"))&&a.removeEventListener("change",QR.checkCDType,!1);$.tag("textarea",b)[0].removeEventListener("keydown",QR.onKeyDown,!1);Draggable.unset($.id("qrHeader"));document.body.removeChild(b)},cloneCaptcha:function(){$.id("qrCaptcha").src=$.id("recaptcha_image").firstChild.src;$.id("qrChallenge").value=$.id("recaptcha_challenge_field").value;$.id("qrCapField").value=""},reloadCaptcha:function(a){var b,c,d;if(!QR.noCaptcha&&(d=$.id("recaptcha_image"))&&Recaptcha)d.firstChild.setAttribute("data-loading","1"),c=function(){clearTimeout(b);d.firstChild.hasAttribute("data-loading")?b=setTimeout(c,100):(d.firstChild.setAttribute("data-loading","1"),QR.captchaInterval=setInterval(QR.cloneCaptcha,QR.captchaDelay),QR.cloneCaptcha(),a&&$.id("qrCapField").focus())},clearInterval(QR.captchaInterval),Recaptcha.reload("t"),b=setTimeout(c,100)},checkCDType:function(){var a,b;QR.activeDelay=QR.cdType&QR.sagePost&&(b=$.id("qrEmail"))&&/sage/i.test(b.value)?QR.sageDelay:QR.cdType&QR.filePost&&(b=$.id("qrFile"))&&b.value?QR.fileDelay:QR.baseDelay;!QR.cooldown&&(a=QR.purgeCooldown())&&QR.startCooldown(a)},onClick:function(a){var b=a.target;if("submit"==b.type)a.preventDefault(),QR.submit(a.shiftKey);else switch(b.id){case"qrFile":a.shiftKey&&(a.preventDefault(),QR.resetFile());break;case"qrDummyFile":case"qrDummyFileButton":case"qrDummyFileLabel":a.preventDefault();a.shiftKey?QR.resetFile():$.id("qrFile").click();break;case"qrCaptcha":QR.reloadCaptcha(!0);break;case"qrClose":QR.close()}},onDragStart:function(){document.removeEventListener("drop",QR.onDrop,!1);document.removeEventListener("dragover",QR.onDragOver,!1)},onDragEnd:function(){document.addEventListener("drop",QR.onDrop,!1);document.addEventListener("dragover",QR.onDragOver,!1)},onDrop:function(a){if(a.dataTransfer.files.length){a.preventDefault();a=a.dataTransfer.files[0];QR.dndFile=a;if(Main.tid)QR.quotePost(Main.tid);else if(!QR.currentTid)return;$.id("qrDummyFileLabel").textContent=a.name}},onDragOver:function(a){a.preventDefault();a.dataTransfer.dropEffect="copy"},showPostError:function(a,b,c){var d;if(d=$.id("qrError"))d.innerHTML=a,d.style.display="block",d.setAttribute("data-type",b||""),!c&&(document.hidden||document.mozHidden||document.webkitHidden||document.msHidden)&&alert("Posting Error")},hidePostError:function(a){var b=$.id("qrError");b.hasAttribute("style")&&(!a||b.getAttribute("data-type")==a)&&b.removeAttribute("style")},resetFile:function(){var a,b;b=document.createElement("input");b.id="qrFile";b.type="file";b.size="19";b.name="upfile";b.addEventListener("change",QR.onFileChange,!1);UA.hasDragAndDrop&&(b.className="qrRealFile",QR.dndFile=null,$.id("qrDummyFileLabel").textContent="No file selected.");a=$.id("qrFile");a.removeEventListener("change",QR.onFileChange,!1);a.parentNode.replaceChild(b,a);QR.hidePostError("imagelimit");QR.checkCDType()},checkBan:function(){QR.banXhr=new XMLHttpRequest;QR.banXhr.open("GET","//api.4chan.org/banned?"+Date.now(),!0);QR.banXhr.timeout=3E3;QR.banXhr.onload=function(){403==this.status?QR.showPostError('You are <a href="https://www.4chan.org/banned" target="_blank">banned</a> ;_;'):QR.showPostError("Connection error.");QR.banXhr=null;QR.btn.value="Submit"};QR.banXhr.onerror=QR.banXhr.ontimeout=function(){QR.banXhr=null;QR.btn.value="Submit";QR.showPostError("Connection error.")};QR.banXhr.send(null)},submit:function(a){var b;QR.banXhr&&(QR.banXhr.abort(),QR.banXhr=null);QR.hidePostError();QR.xhr?(QR.xhr.abort(),QR.xhr=null,QR.showPostError("Aborted"),QR.btn.value="Submit"):!a&&QR.cooldown?QR.btn.value=(QR.auto=!QR.auto)?QR.cooldown+"s (auto)":QR.cooldown+"s":(QR.auto=!1,!a&&(b=$.id("qrCapField"))&&""==b.value?(QR.showPostError("You forgot to type in the CAPTCHA."),b.focus()):(QR.xhr=new XMLHttpRequest,QR.xhr.open("POST",document.forms.qrPost.action,!0),QR.xhr.withCredentials=!0,QR.xhr.upload.onprogress=function(a){QR.btn.value=a.loaded>=a.total?"100%":(0|100*(a.loaded/a.total))+"%"},QR.xhr.onerror=function(){QR.xhr=null;QR.checkBan()},QR.xhr.onload=function(){var a,b,e;QR.xhr=null;QR.btn.value="Submit";if(200==this.status)if(a=this.responseText.match(/"errmsg"[^>]*>(.*?)<\/span/))QR.reloadCaptcha(),QR.showPostError(a[1]);else{a=QR.dndFile||(b=$.id("qrFile"))&&b.value;e=1;if((b=$.id("qrEmail"))&&/sage/i.test(b.value))e|=QR.sagePost;a&&(e|=QR.filePost);e=Date.now()+"-"+e;localStorage.setItem("4chan-cd-"+Main.board,e);if(Config.persistentQR){QR.startCooldown(e);$.byName("com")[1].value="";$.byName("sub")[1].value="";if(b=$.byName("spoiler")[2])b.checked=!1;QR.reloadCaptcha();a&&QR.resetFile()}else Recaptcha&&Recaptcha.reload("t"),QR.close();if(a=this.responseText.match(/\x3c!-- thread:([0-9]+),no:([0-9]+) --\x3e/))b=a[1],a=a[2],Main.tid?(QR.lastReplyId=+a,Parser.trackedReplies[">>"+
a]=1,Parser.saveTrackedReplies(b,Parser.trackedReplies)):(e=Parser.getTrackedReplies(b)||{},e[">>"+a]=1,Parser.saveTrackedReplies(b,e));ThreadUpdater.enabled&&setTimeout(ThreadUpdater.forceUpdate,500)}else QR.showPostError("Error: "+this.status+" "+this.statusText)},QR.dndFile?(b=$.id("qrFile"),b.disabled=!0,a=new FormData(document.forms.qrPost),a.append("upfile",QR.dndFile),b.disabled=!1):a=new FormData(document.forms.qrPost),clearInterval(QR.pulse),QR.btn.value="Sending",QR.xhr.send(a)))},purgeCooldown:function(){var a,b,c;if(a=localStorage.getItem("4chan-cd-"+Main.board))if(b=a.split("-"),c=parseInt(b[0],10),b=+b[1],b=b&QR.sagePost?QR.sageDelay:b&QR.filePost?QR.fileDelay:QR.baseDelay,c=Date.now()-c,c>=b||0>c)localStorage.removeItem("4chan-cd-"+Main.board);else return a},startCooldown:function(a){var b;!QR.noCooldown&&($.id("quickReply")&&!QR.xhr)&&(clearInterval(QR.pulse),a=a.split("-"),QR.timestamp=parseInt(a[0],10),QR.cdType=+a[1],QR.activeDelay=QR.cdType&QR.sagePost&&(b=$.id("qrEmail"))&&/sage/i.test(b.value)?QR.sageDelay:QR.cdType&QR.filePost&&(b=$.id("qrFile"))&&b.value?QR.fileDelay:QR.baseDelay,QR.cdElapsed=Date.now()-QR.timestamp,QR.cooldown=Math.floor((QR.activeDelay-QR.cdElapsed)/1E3),0>=QR.cooldown||0>QR.cdElapsed?QR.cooldown=!1:(QR.btn.value=QR.cooldown+"s",QR.pulse=setInterval(QR.onPulse,1E3)))},onPulse:function(){QR.cdElapsed=Date.now()-QR.timestamp;QR.cooldown=Math.floor((QR.activeDelay-QR.cdElapsed)/1E3);0>=QR.cooldown?(clearInterval(QR.pulse),QR.btn.value="Submit",QR.cooldown=!1,QR.auto&&QR.submit()):QR.btn.value=QR.cooldown+(QR.auto?"s (auto)":"s")}},ThreadHiding={init:function(){this.threshold=6048E5;this.hidden={};this.load()},clear:function(a){var b,c;this.load();b=0;for(c in this.hidden)++b;c="4chan-hide-t-"+Main.board;a?localStorage.removeItem(c):b?(a="This will unhide "+b+" thread"+(1<b?"s":"")+" on /"+Main.board+"/",confirm(a)&&localStorage.removeItem(c)):alert("You don't have any hidden threads on /"+Main.board+"/")},isHidden:function(a){a=$.id("sa"+a);return!a||a.hasAttribute("data-hidden")},toggle:function(a){this.isHidden(a)?this.show(a):this.hide(a);this.save()},show:function(a){var b,c;c=$.id("t"+a);b=$.id("sa"+a);b.removeAttribute("data-hidden");Main.hasMobileLayout?(b.textContent="Hide",$.removeClass(b,"mobile-tu-show"),$.cls("postLink",c)[0].appendChild(b),c.style.display=null,$.removeClass(c.nextElementSibling,"mobile-hr-hidden")):(b.firstChild.src=Main.icons.minus,$.removeClass(c,"post-hidden"));delete this.hidden[a]},hide:function(a){var b,c;c=$.id("t"+a);Main.hasMobileLayout?(c.style.display="none",$.addClass(c.nextElementSibling,"mobile-hr-hidden"),b=$.id("sa"+a),b.setAttribute("data-hidden",a),b.textContent="Show Hidden Thread",$.addClass(b,"mobile-tu-show"),c.parentNode.insertBefore(b,c)):Config.hideStubs&&!$.cls("stickyIcon",c)[0]?c.style.display=c.nextElementSibling.style.display="none":(b=$.id("sa"+a),b.setAttribute("data-hidden",a),b.firstChild.src=Main.icons.plus,c.className+=" post-hidden");this.hidden[a]=Date.now()},load:function(){var a;if(a=localStorage.getItem("4chan-hide-t-"+
Main.board))this.hidden=JSON.parse(a)},purge:function(){var a,b;b=Date.now();for(a in this.hidden)b-this.hidden[a]>this.threshold&&delete this.hidden[a];this.save()},save:function(){for(var a in this.hidden){localStorage.setItem("4chan-hide-t-"+Main.board,JSON.stringify(this.hidden));return}localStorage.removeItem("4chan-hide-t-"+Main.board)}},ReplyHiding={init:function(){this.threshold=6048E5;this.hidden={};this.load()},isHidden:function(a){a=$.id("sa"+a);return!a||a.hasAttribute("data-hidden")},toggle:function(a){this.isHidden(a)?this.show(a):this.hide(a);this.save()},show:function(a){var b;b=$.id("pc"+a);$.removeClass(b,"post-hidden");b=$.id("sa"+a);b.removeAttribute("data-hidden");b.firstChild.src=Main.icons.minus;delete this.hidden[a]},hide:function(a){var b;$.id("pc"+a).className+=" post-hidden";b=$.id("sa"+a);b.setAttribute("data-hidden",a);b.firstChild.src=Main.icons.plus;this.hidden[a]=Date.now()},load:function(){var a;if(a=localStorage.getItem("4chan-hide-r-"+Main.board))this.hidden=JSON.parse(a)},purge:function(){var a,b;b=Date.now();for(a in this.hidden)b-this.hidden[a]>this.threshold&&delete this.hidden[a];this.save()},save:function(){for(var a in this.hidden){localStorage.setItem("4chan-hide-r-"+Main.board,JSON.stringify(this.hidden));return}localStorage.removeItem("4chan-hide-r-"+Main.board)}},ThreadWatcher={init:function(){var a;this.listNode=null;this.charLimit=45;this.watched={};this.isRefreshing=!1;a=document.createElement("div");a.id="threadWatcher";a.className="extPanel reply";a.setAttribute("data-trackpos","TW-position");Config["TW-position"]?a.style.cssText=Config["TW-position"]:(a.style.left="10px",a.style.top="380px");a.style.position=Config.fixedThreadWatcher?"fixed":"";a.innerHTML='<div class="drag" id="twHeader">Thread Watcher'+(UA.hasCORS?'<img id="twPrune" class="pointer right" src="'+Main.icons.refresh+'" alt="R" title="Refresh"></div>':"</div>");this.listNode=document.createElement("ul");this.listNode.id="watchList";this.load();Main.tid&&this.refreshCurrent();this.build();a.appendChild(this.listNode);document.body.appendChild(a);a.addEventListener("mouseup",this.onClick,!1);Draggable.set($.id("twHeader"));window.addEventListener("storage",this.syncStorage,!1);!Main.tid&&this.canAutoRefresh()&&this.refresh()},syncStorage:function(a){var b;a.key&&(b=a.key.split("-"),"4chan"==b[0]&&("watch"==b[1]&&a.newValue!=a.oldValue)&&(ThreadWatcher.watched=JSON.parse(a.newValue),ThreadWatcher.build(!0)))},load:function(){if(storage=localStorage.getItem("4chan-watch"))this.watched=JSON.parse(storage)},build:function(a){var b,c,d,e;b="";for(d in this.watched)c=d.split("-"),b+='<li id="watch-'+d+'"><span class="pointer" data-cmd="unwatch" data-id="'+c[0]+'" data-board="'+c[1]+'">&times;</span> <a href="'+Main.linkToThread(c[0],c[1],this.watched[d][1])+'"',b=-1==this.watched[d][1]?b+' class="deadlink">':this.watched[d][2]?b+(' class="hasNewReplies">('+this.watched[d][2]+") "):b+">",b+="/"+c[1]+"/ - "+this.watched[d][0]+"</a></li>";if(a){c=$.cls("wbtn",$.id("delform"));for(a=0;e=c[a];++a)d=e.getAttribute("data-id")+"-"+Main.board,ThreadWatcher.watched[d]?e.hasAttribute("data-active")||(e.src=Main.icons.watched,e.setAttribute("data-active","1")):e.hasAttribute("data-active")&&(e.src=Main.icons.notwatched,e.removeAttribute("data-active"))}ThreadWatcher.listNode.innerHTML=b},onClick:function(a){a=a.target;a.hasAttribute("data-id")?ThreadWatcher.toggle(a.getAttribute("data-id"),a.getAttribute("data-board")):a.src&&!ThreadWatcher.isRefreshing&&ThreadWatcher.refresh()},toggle:function(a,b){var c,d,e,f;c=a+"-"+(b||Main.board);if(this.watched[c]){if(delete this.watched[c],c=$.id("wbtn-"+c))c.src=Main.icons.notwatched,c.removeAttribute("data-active")}else if(d=(d=$.cls("subject",$.id("pi"+a))[0].textContent)?d.slice(0,this.charLimit):(d=$.id("m"+a).innerHTML)?d.replace(/(?:<br>)+/g," ").replace(/<[^>]*?>/g,"").slice(0,this.charLimit):"No."+a,e=(f=$.id("t"+a)).children[1]?f.lastElementChild.id.slice(2):a,this.watched[c]=[d,e,0],c=$.id("wbtn-"+c))c.src=Main.icons.watched,c.setAttribute("data-active","1");this.save();this.load();this.build()},save:function(){ThreadWatcher.sortByBoard();localStorage.setItem("4chan-watch",JSON.stringify(ThreadWatcher.watched))},sortByBoard:function(){var a,b,c,d,e;b=ThreadWatcher;d={};e=[];for(c in b.watched)e.push(c);e.sort(function(a,b){a=a.split("-")[1];b=b.split("-")[1];return a<b?-1:a>b?1:0});for(a=0;c=e[a];++a)d[c]=b.watched[c];b.watched=d},canAutoRefresh:function(){var a;return(a=localStorage.getItem("4chan-tw-timestamp"))?6E4<=Date.now()-+a:!1},setRefreshTimestamp:function(){localStorage.setItem("4chan-tw-timestamp",Date.now())},refresh:function(){var a,b,c,d,e;if(d=$.id("watchList").children.length)for(c in a=b=0,e=$.id("twPrune"),e.src=Main.icons.rotate,ThreadWatcher.isRefreshing=!0,ThreadWatcher.setRefreshTimestamp(),ThreadWatcher.watched)setTimeout(ThreadWatcher.fetch,b,c,++a==d?e:null),b+=200},refreshCurrent:function(a){var b,c,d;b=Main.tid+"-"+Main.board;this.watched[b]&&(d=(c=$.id("t"+Main.tid)).children[1]?c.lastElementChild.id.slice(2):Main.tid,this.watched[b][1]!=d&&(this.watched[b][1]=d),this.watched[b][2]=0,this.save(),a&&this.build())},onRefreshEnd:function(a){a.src=Main.icons.refresh;this.isRefreshing=!1;this.save();this.load();this.build()},fetch:function(a,b){var c,d;c=$.id("watch-"+a);if(-1==ThreadWatcher.watched[a][1]){if(delete ThreadWatcher.watched[a],c.parentNode.removeChild(c),b)ThreadWatcher.onRefreshEnd(b)}else c=a.split("-"),d=new XMLHttpRequest,d.onload=function(){var c,d,g,h;if(200==this.status){g=Parser.parseThreadJSON(this.responseText);h=ThreadWatcher.watched[a][1];d=0;for(c=g.length-
1;1<=c&&!(g[c].no<=h);c--)++d;d>ThreadWatcher.watched[a][2]&&(ThreadWatcher.watched[a][2]=d)}else 404==this.status&&(ThreadWatcher.watched[a][1]=-1);if(b)ThreadWatcher.onRefreshEnd(b)},b&&(d.onerror=d.onload),d.open("GET","//api.4chan.org/"+c[1]+"/res/"+c[0]+".json"),d.send(null)}},ThreadExpansion={init:function(){this.enabled=UA.hasCORS},expandComment:function(a){var b,c,d,e;if(b=a.getAttribute("href").match(/^(?:res\/)([0-9]+)#p([0-9]+)$/))c=b[1],d=b[2],e=a.parentNode,e.textContent="Loading...",$.get("//api.4chan.org/"+Main.board+"/res/"+c+".json",{onload:function(){var a,b,h,k;if(200==this.status){b=$.id("m"+d);k=Parser.parseThreadJSON(this.responseText);if(c==d)h=k[0].com;else for(a=k.length-1;0<a;a--)if(k[a].no==d){h=k[a].com;break}h?(b.innerHTML=h,Parser.prettify&&Parser.parseMarkup(b),window.jsMath&&Parser.parseMathOne(b)):e.textContent="This post doesn't exist anymore."}else 404==this.status?e.textContent="This thread doesn't exist anymore.":(e.textContent="Connection Error",console.log("ThreadExpansion: "+
this.status+" "+this.statusText))},onerror:function(){e.textContent="Connection Error";console.log("ThreadExpansion: xhr failed")}})},toggle:function(a){var b,c,d,e;b=$.id("t"+a);e=b.children[1];b.hasAttribute("data-truncated")&&(c=$.id("m"+a),d=c.nextSibling);$.hasClass(b,"tExpanded")?(b.className=b.className.replace(" tExpanded"," tCollapsed"),e.children[0].src=Main.icons.plus,e.children[1].style.display="inline",e.children[2].style.display="none",c&&(a=c.innerHTML,c.innerHTML=d.textContent,d.textContent=a)):$.hasClass(b,"tCollapsed")?(b.className=b.className.replace(" tCollapsed"," tExpanded"),e.children[0].src=Main.icons.minus,e.children[1].style.display="none",e.children[2].style.display="inline",c&&(a=c.innerHTML,c.innerHTML=d.textContent,d.textContent=a)):(e.children[0].src=Main.icons.rotate,ThreadExpansion.fetch(a))},fetch:function(a){$.get("//api.4chan.org/"+Main.board+"/res/"+a+".json",{onload:function(){var b,c,d,e,f,g,h,k;e=$.id("t"+a);k=e.children[1];if(200==this.status){f=$.cls("reply",e);g=Parser.parseThreadJSON(this.responseText);!Config.revealSpoilers&&g[0].custom_spoiler&&Parser.setCustomSpoiler(Main.board,g[0].custom_spoiler);d=document.createDocumentFragment();if(f[0]){f=+f[0].id.slice(1);for(b=1;c=g[b];++b)if(c.no<f)c=Parser.buildHTMLFromJSON(c,Main.board),c.className+=" rExpanded",d.appendChild(c);else break}else for(b=1;c=g[b];++b)c=Parser.buildHTMLFromJSON(c,Main.board),c.className+=" rExpanded",d.appendChild(c);f=$.id("m"+a);if((h=$.cls("abbr",f)[0])&&/^Comment/.test(h.textContent))e.setAttribute("data-truncated","1"),h=document.createElement("div"),h.style.display="none",h.textContent=f.innerHTML,f.parentNode.insertBefore(h,f.nextSibling),(h=$.cls("capcodeReplies",f)[0])?(f.innerHTML=g[0].com+"<br><br>",f.appendChild(h)):f.innerHTML=g[0].com,Parser.prettify&&Parser.parseMarkup(f),window.jsMath&&Parser.parseMathOne(f);e.insertBefore(d,k.nextSibling);Parser.parseThread(a,1,b-1);e.className+=" tExpanded";k.children[0].src=Main.icons.minus;k.children[1].style.display="none";k.children[2].style.display="inline"}else 404==this.status?(k.children[0].src=Main.icons.plus,k.children[0].display="none",k.children[1].textContent="This thread doesn't exist anymore."):(k.children[0].src=Main.icons.plus,console.log("ThreadExpansion: "+this.status+" "+this.statusText))},onerror:function(){$.id("t"+a).children[1].children[0].src=Main.icons.plus;console.log("ThreadExpansion: xhr failed")}})}},ThreadUpdater={init:function(){UA.hasCORS&&(this.enabled=!0,this.pageTitle=document.title,this.unreadCount=0,this.auto=!1,this.delayId=0,this.delayIdHidden=4,this.delayRange=[10,15,20,30,60,90,120,180,240,300],this.timeLeft=0,this.interval=null,this.lastModified="0",this.lastReply=null,this.iconPath="//static.4chan.org/image/",this.iconNode=document.head.querySelector('link[rel="shortcut icon"]'),this.iconNode.type="image/x-icon",this.defaultIcon=this.iconNode.getAttribute("href").replace(this.iconPath,""),this.deletionQueue={},Config.updaterSound&&(this.audioEnabled=!1,this.audio=document.createElement("audio"),this.audio.src="//static.4chan.org/media/beep.ogg"),this.hidden="hidden",this.visibilitychange="visibilitychange","undefined"===typeof document.hidden&&("mozHidden"in document?(this.hidden="mozHidden",this.visibilitychange="mozvisibilitychange"):"webkitHidden"in document?(this.hidden="webkitHidden",this.visibilitychange="webkitvisibilitychange"):"msHidden"in document&&(this.hidden="msHidden",this.visibilitychange="msvisibilitychange")),this.initControls(),(Config.alwaysAutoUpdate||sessionStorage.getItem("4chan-auto-"+Main.tid))&&this.start())},buildMobileControl:function(a,b){var c,d,e,f;b=b?"Bot":"";a.textContent="Update";a.removeAttribute("onmouseup");a.setAttribute("data-cmd","update");c=a.parentNode.parentNode;d=document.createElement("span");d.className="mobileib button";f=document.createElement("label");e=document.createElement("input");e.type="checkbox";e.setAttribute("data-cmd","auto");this["autoNode"+b]=e;f.appendChild(e);f.appendChild(document.createTextNode("Auto"));d.appendChild(f);c.appendChild(document.createTextNode(" "));c.appendChild(d);f=document.createElement("div");f.className="mobile-tu-status";c.appendChild(this["statusNode"+b]=f);$.id("mpostform").parentNode.style.marginTop=""},buildDesktopControl:function(a){var b,c,d,e;a=a?"Bot":"";b=document.createDocumentFragment();b.appendChild(document.createTextNode(" ["));c=document.createElement("a");c.href="";c.textContent="Update";c.setAttribute("data-cmd","update");b.appendChild(c);b.appendChild(document.createTextNode("]"));b.appendChild(document.createTextNode(" ["));d=document.createElement("label");c=document.createElement("input");c.type="checkbox";c.title="Fetch new replies automatically";c.setAttribute("data-cmd","auto");this["autoNode"+a]=c;d.appendChild(c);d.appendChild(document.createTextNode("Auto"));b.appendChild(d);b.appendChild(document.createTextNode("] "));Config.updaterSound&&(b.appendChild(document.createTextNode(" [")),d=document.createElement("label"),c=document.createElement("input"),c.type="checkbox",c.title="Play a sound on new replies to your posts",c.setAttribute("data-cmd","sound"),this["soundNode"+a]=c,d.appendChild(c),d.appendChild(document.createTextNode("Sound")),b.appendChild(d),b.appendChild(document.createTextNode("] ")));b.appendChild(this["statusNode"+a]=document.createElement("span"));(e=$.cls("navLinks"+a)[0])&&e.appendChild(b)},initControls:function(){Main.hasMobileLayout?(this.buildMobileControl($.id("refresh_top")),this.buildMobileControl($.id("refresh_bottom"),!0)):(this.buildDesktopControl(),this.buildDesktopControl(!0))},start:function(){this.auto=!0;this.autoNode.checked=this.autoNodeBot.checked=!0;this.force=this.updating=!1;this.lastUpdated=Date.now();this.hidden&&document.addEventListener(this.visibilitychange,this.onVisibilityChange,!1);document.addEventListener("scroll",this.onScroll,!1);this.delayId=0;this.timeLeft=this.delayRange[0];this.pulse();sessionStorage.setItem("4chan-auto-"+Main.tid,1)},stop:function(a){clearTimeout(this.interval);this.auto=this.updating=this.force=!1;this.autoNode.checked=this.autoNodeBot.checked=!1;this.hidden&&document.removeEventListener(this.visibilitychange,this.onVisibilityChange,!1);a&&(this.setStatus(""),this.setIcon(this.defaultIcon));sessionStorage.removeItem("4chan-auto-"+Main.tid)},pulse:function(){var a=ThreadUpdater;0==a.timeLeft?a.update():(a.setStatus(a.timeLeft--),a.interval=setTimeout(a.pulse,1E3))},adjustDelay:function(a){0==a?this.force||this.delayId<this.delayRange.length-1&&++this.delayId:this.delayId=document[this.hidden]?this.delayIdHidden:0;this.timeLeft=this.delayRange[this.delayId];this.auto&&this.pulse()},onVisibilityChange:function(){var a=ThreadUpdater;a.delayId=document[a.hidden]&&a.delayId<a.delayIdHidden?a.delayIdHidden:0;a.timeLeft=a.delayRange[0];a.lastUpdated=Date.now();clearTimeout(a.interval);a.pulse()},onScroll:function(){document.documentElement.scrollHeight<=window.innerHeight+window.pageYOffset&&!document[ThreadUpdater.hidden]&&ThreadUpdater.clearUnread()},clearUnread:function(){this.dead||this.setIcon(this.defaultIcon);this.lastReply&&(this.unreadCount=0,document.title=this.pageTitle,$.removeClass(this.lastReply,"newPostsMarker"),this.lastReply=null)},forceUpdate:function(){ThreadUpdater.force=!0;ThreadUpdater.update()},toggleAuto:function(){this.updating||(this.auto?this.stop(!0):this.start())},toggleSound:function(){this.soundNode.checked=this.soundNodeBot.checked=this.audioEnabled=!this.audioEnabled},update:function(){var a;Date.now();a=ThreadUpdater;a.updating||(clearTimeout(a.interval),a.updating=!0,a.setStatus("Updating..."),$.get("//api.4chan.org/"+Main.board+"/res/"+Main.tid+".json",{onload:a.onload,onerror:a.onerror},{"If-Modified-Since":a.lastModified}))},markDeletedReplies:function(a){var b,c,d,e;d={};for(b=0;c=a[b];++b)d["pc"+c.no]=1;a=$.cls("replyContainer");for(b=0;c=a[b];++b)!d[c.id]&&!$.hasClass(c,"deleted")&&(this.deletionQueue[c.id]?(e=document.createElement("img"),e.src=Main.icons2.trash,e.className="trashIcon",e.title="This post has been deleted",$.addClass(c,"deleted"),$.cls("postNum",c)[1].appendChild(e),delete this.deletionQueue[c.id]):this.deletionQueue[c.id]=1)},onload:function(){var a,b,c,d,e,f,g,h,k,l,m,n;b=ThreadUpdater;c=[];b.setStatus("");if(200==this.status){b.lastModified=this.getResponseHeader("Last-Modified");d=$.id("t"+Main.tid);g=d.children[d.childElementCount-1];h=+g.id.slice(2);e=Parser.parseThreadJSON(this.responseText);a=!!e[0].closed;a!=Main.threadClosed&&(QR.enabled&&$.id("quickReply")&&(a?QR.lock():QR.unlock()),Main.setThreadState("closed",a));a=!!e[0].sticky;a!=Main.threadSticky&&Main.setThreadState("sticky",a);a=!!e[0].imagelimit;QR.enabled&&a!=QR.fileDisabled&&(QR.fileDisabled=a);!Config.revealSpoilers&&e[0].custom_spoiler&&Parser.setCustomSpoiler(Main.board,e[0].custom_spoiler);for(a=e.length-1;0<=a&&!(e[a].no<=h);a--)c.push(e[a]);m=c.length;1==m&&QR.lastReplyId==c[0].no&&(n=!0,QR.lastReplyId=null);n||b.markDeletedReplies(e);if(m){k=document.documentElement;l=Config.autoScroll&&document[b.hidden]&&k.scrollHeight==window.innerHeight+window.pageYOffset;f=document.createDocumentFragment();for(a=c.length-1;0<=a;a--)f.appendChild(Parser.buildHTMLFromJSON(c[a],Main.board));d.appendChild(f);Parser.hasYouMarkers=!1;Parser.parseThread(d.id.slice(1),-c.length);n||(!b.force&&k.scrollHeight>window.innerHeight?(!b.lastReply&&h!=Main.tid&&((b.lastReply=g.lastChild).className+=" newPostsMarker"),Parser.hasYouMarkers?(b.setIcon(b.icons[Main.type+"rep"]),b.audioEnabled&&document[b.hidden]&&b.audio.play()):0==b.unreadCount&&b.setIcon(b.icons[Main.type]),b.unreadCount+=m,document.title="("+b.unreadCount+") "+b.pageTitle):b.setStatus(m+" new post"+(1<m?"s":"")));l&&window.scrollTo(0,document.documentElement.scrollHeight);Config.threadWatcher&&ThreadWatcher.refreshCurrent(!0);Config.threadStats&&(d=e[0],ThreadStats.update(d.replies,d.images,d.bumplimit,d.imagelimit))}else b.setStatus("No new posts")}else if(304==this.status||0==this.status)b.setStatus("No new posts");else if(404==this.status){b.setIcon(b.icons[Main.type+"dead"]);b.setError("This thread has been pruned or deleted");b.dead=!0;b.stop();return}b.lastUpdated=Date.now();b.adjustDelay(c.length);b.updating=b.force=!1},onerror:function(){var a=ThreadUpdater;UA.isOpera&&!this.statusText&&0==this.status?a.setStatus("No new posts"):a.setError("Connection Error");a.lastUpdated=Date.now();a.adjustDelay(0);a.updating=a.force=!1},setStatus:function(a){this.statusNode.textContent=this.statusNodeBot.textContent=a},setError:function(a){this.statusNode.innerHTML=this.statusNodeBot.innerHTML='<span class="tu-error">'+a+"</span>"},setIcon:function(a){this.iconNode.href=this.iconPath+a;document.head.appendChild(this.iconNode)},icons:{ws:"favicon-ws-newposts.ico",nws:"favicon-nws-newposts.ico",wsrep:"favicon-ws-newreplies.ico",nwsrep:"favicon-nws-newreplies.ico",wsdead:"favicon-ws-deadthread.ico",nwsdead:"favicon-nws-deadthread.ico"}},ThreadStats={init:function(){var a;this.nodeTop=document.createElement("div");this.nodeTop.className="thread-stats";this.nodeBot=this.nodeTop.cloneNode(!1);a=$.cls("navLinks");a[0]&&a[0].appendChild(this.nodeTop);a[3]&&a[3].appendChild(this.nodeBot);this.pageNumber=null;this.updatePageNumber();this.pageInterval=setInterval(this.updatePageNumber,18E4);this.update(null,null,window.bumplimit,window.imagelimit)},update:function(a,b,c,d){null===a&&(a=$.cls("replyContainer").length,b=$.cls("fileText").length-($.id("fT"+Main.tid)?1:0));a=a+" repl"+(1<a||!a?"ies":"y");b=b+" image"+(1<b||!b?"s":"");c&&(a='<em title="Bump limit reached">'+a+"</em>");d&&(b='<em title="Image limit reached">'+b+"</em>");c=Main.threadSticky?" [Sticky]":"";Main.threadClosed&&(c+=" [Closed]");this.nodeTop.innerHTML=this.nodeBot.innerHTML="["+a+"] ["+b+"]"+c+(null!==this.pageNumber?'<span class="ts-page"> [Page '+this.pageNumber+"]</span>":"")},updatePageNumber:function(){$.get("//api.4chan.org/"+Main.board+"/threads.json",{onload:ThreadStats.onCatalogLoad,onerror:ThreadStats.onCatalogError})},onCatalogLoad:function(){var a,b,c,d,e,f,g;a=ThreadStats;if(200==this.status){g=+Main.tid;f=JSON.parse(this.responseText);for(b=0;c=f[b];++b){e=c.threads;for(c=0;d=e[c];++c)if(d.no==g){null===a.pageNumber?a.nodeTop.innerHTML=a.nodeBot.innerHTML+='<span class="ts-page"> [Page '+b+"]</span>":(f=$.cls("ts-page"),f[0].textContent=f[1].textContent=" [Page "+b+"]");a.pageNumber=b;return}}clearInterval(a.pageInterval)}else ThreadStats.onCatalogError()},onCatalogError:function(){console.log("ThreadStats: couldn't get the catalog ("+this.status+")")}},Filter={init:function(){this.entities=document.createElement("div");Filter.load()},onClick:function(a){var b;if(b=a.target.getAttribute("data-cmd"))switch(b){case"filters-add":Filter.add();break;case"filters-save":Filter.save();Filter.close();break;case"filters-close":Filter.close();break;case"filters-palette":Filter.openPalette(a.target);break;case"filters-palette-close":Filter.closePalette();break;case"filters-palette-clear":Filter.clearPalette();break;case"filters-up":Filter.moveUp(a.target.parentNode.parentNode);break;case"filters-del":Filter.remove(a.target.parentNode.parentNode);break;case"filters-help-open":Filter.openHelp();break;case"filters-help-close":Filter.closeHelp()}},onPaletteClick:function(a){var b;if(b=a.target.getAttribute("data-cmd"))switch(b){case"palette-pick":Filter.pickColor(a.target);break;case"palette-clear":Filter.pickColor(a.target,!0);break;case"palette-close":Filter.closePalette()}},exec:function(a,b,c,d){var e,f,g,h,k,l,m,n,p;if(Parser.trackedReplies&&Parser.trackedReplies[">>"+b.id.slice(2)])return!1;n=Filter.activeFilters;p=!1;for(i=0;m=n[i];++i)if(0==m.type){if((e||(e=b.getElementsByClassName("postertrip")[0]))&&m.pattern==e.textContent){p=!0;break}}else if(1==m.type){if((f||(f=b.getElementsByClassName("name")[0]))&&m.pattern==f.textContent){p=!0;break}}else if(2==m.type){if(g||(this.entities.innerHTML=c.innerHTML.replace(/<br>/g,"\n").replace(/[<[^>]+>/g,""),g=this.entities.textContent),m.pattern.test(g)){p=!0;break}}else if(3==m.type){if((h||(h=b.getElementsByClassName("useremail")[0])&&(h=h.href.slice(7)))&&m.pattern.test(h)){p=!0;break}}else if(4==m.type){if((k||(k=b.getElementsByClassName("posteruid")[0])&&(k=k.firstElementChild.textContent))&&m.pattern==k){p=!0;break}}else if((l||(l=b.getElementsByClassName("subject")[0])&&(l=l.textContent))&&m.pattern.test(l)){p=!0;break}if(p){if(m.hide)return a.className+=" post-hidden",el=document.createElement("span"),d?el.innerHTML='[<a data-filtered="1" href="res/'+d+'">View</a>]':(el.textContent="[View]",el.setAttribute("data-filtered","1")),el.className="filter-preview",b.appendChild(el),!0;a.className+=" filter-hl";a.style.boxShadow="-3px 0 "+m.color}return!1},load:function(){var a,b,c,d,e,f,g,h,k,l;this.activeFilters=[];if(c=localStorage.getItem("4chan-filters")){c=JSON.parse(c);f=RegExp("(\\/|\\.|\\*|\\+|\\?|\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");g=/^\/(.*)\/(i?)$/;l=/\\\*/g;try{for(e=0;b=c[e];++e)if(b.active&&""!=b.pattern){d=b.pattern;if(!b.type||1==b.type||4==b.type)pattern=d;else if(match=d.match(g))pattern=RegExp(match[1],match[2]);else if('"'==d[0]&&'"'==d[d.length-1])pattern=RegExp(d.slice(1,-1).replace(f,"\\$1"));else{h=d.split(" ");pattern="";a=0;for(j=h.length;a<j;++a)k=h[a].replace(f,"\\$1").replace(l,"[^\\s]*"),pattern+="(?=.*\\b"+k+"\\b)";pattern=RegExp("^"+pattern,"im")}this.activeFilters.push({type:b.type,pattern:pattern,color:b.color,hide:b.hide})}}catch(m){alert("There was an error processing one of the filters: "+m+" in: "+d)}}},addSelection:function(){var a,b;a=UA.getSelection(!0);!1!==Filter.open()&&("string"==typeof a?a=a.trim():(b=a.anchorNode.parentNode,a=a.toString().trim(),b=$.hasClass(b,"name")?1:$.hasClass(b,"postertrip")?0:$.hasClass(b,"subject")?5:$.hasClass(b,"posteruid")||$.hasClass(b,"hand")?4:2),Filter.add(a,b))},openHelp:function(){var a;$.id("filtersHelp")||(a=document.createElement("div"),a.id="filtersHelp",a.className="UIPanel",a.setAttribute("data-cmd","filters-help-close"),a.innerHTML='<div class="extPanel reply"><div class="panelHeader">Filters &amp; Highlights Help<span><img alt="Close" title="Close" class="pointer" data-cmd="filters-help-close" src="'+Main.icons.cross+'"></span></div><h4>Tripcode, Name and ID filters:</h4><ul><li>Those use simple string comparison.</li><li>Type them exactly as they appear on 4chan, including the exclamation mark for tripcode filters.</li><li>Example: <code>!Ep8pui8Vw2</code></li></ul><h4>Comment, Subject and E-mail filters:</h4><ul><li><strong>Matching whole words:</strong></li><li><code>feel</code> &mdash; will match <em>"feel"</em> but not <em>"feeling"</em>. This search is case-insensitive.</li></ul><ul><li><strong>AND operator:</strong></li><li><code>feel girlfriend</code> &mdash; will match <em>"feel"</em> AND <em>"girlfriend"</em> in any order.</li></ul><ul><li><strong>Exact match:</strong></li><li><code>"that feel when"</code> &mdash; place double quotes around the pattern to search for an exact string</li></ul><ul><li><strong>Wildcards:</strong></li><li><code>feel*</code> &mdash; matches expressions such as <em>"feel"</em>, <em>"feels"</em>, <em>"feeling"</em>, <em>"feeler"</em>, etc\u2026</li><li><code>idolm*ster</code> &mdash; this can match <em>"idolmaster"</em> or <em>"idolm@ster"</em>, etc\u2026</li></ul><ul><li><strong>Regular expressions:</strong></li><li><code>/feel when no (girl|boy)friend/i</code></li><li><code>/^(?!.*touhou).*$/i</code> &mdash; NOT operator.</li><li><code>/^>/</code> &mdash; comments starting with a quote.</li><li><code>/^$/</code> &mdash; comments with no text.</li></ul><h4>Colors:</h4><ul><li>The color field can accept any valid CSS color:</li><li><code>red</code>, <code>#0f0</code>, <code>#00ff00</code>, <code>rgba( 34, 12, 64, 0.3)</code>, etc\u2026</li></ul><h4>Shortcut:</h4><ul><li>If you have <code>Keyboard shortcuts</code> enabled, pressing <kbd>F</kbd> will add the selected text to your filters.</li></ul>',document.body.appendChild(a),a.addEventListener("click",this.onClick,!1))},closeHelp:function(){var a;if(a=$.id("filtersHelp"))a.removeEventListener("click",this.onClick,!1),document.body.removeChild(a)},open:function(){var a,b,c,d,e;if($.id("filtersMenu"))return!1;c=document.createElement("div");c.id="filtersMenu";c.className="UIPanel";c.style.display="none";c.setAttribute("data-cmd","filters-close");c.innerHTML='<div class="extPanel reply"><div class="panelHeader">Filters &amp; Highlights<span><img alt="Help" class="pointer" title="Help" data-cmd="filters-help-open" src="'+
Main.icons.help+'"><img alt="Close" title="Close" class="pointer" data-cmd="filters-close" src="'+Main.icons.cross+'"></span></div><table><thead><tr><th>Order</th><th>On</th><th>Pattern</th><th>Type</th><th>Color</th><th>Hide</th><th>Del</th></tr></thead><tbody id="filter-list"></tbody><tfoot><tr><td colspan="7"><button data-cmd="filters-add">Add</button><button class="right" data-cmd="filters-save">Save</button></td></tr></tfoot></table></div>';document.body.appendChild(c);c.addEventListener("click",this.onClick,!1);e=$.id("filter-list");if(d=localStorage.getItem("4chan-filters")){d=JSON.parse(d);for(a=0;b=d[a];++a)e.appendChild(this.buildEntry(b,a))}c.style.display=""},close:function(){var a;if(a=$.id("filtersMenu"))this.closePalette(),a.removeEventListener("click",this.onClick,!1),document.body.removeChild(a)},moveUp:function(a){var b;(b=a.previousElementSibling)&&a.parentNode.insertBefore(a,b)},add:function(a,b){var c,d;c={active:!0,type:b||0,pattern:a||"",color:"",hide:!1};d=this.getNextFilterId();c=this.buildEntry(c,d);$.id("filter-list").appendChild(c);$.cls("fPattern",c)[0].focus()},remove:function(a){$.id("filter-list").removeChild(a)},save:function(){var a,b,c,d,e;b=[];c=$.id("filter-list").children;for(a=0;d=c[a];++a)e={active:d.children[1].firstChild.checked,pattern:d.children[2].firstChild.value,type:d.children[3].firstChild.selectedIndex,hide:d.children[5].firstChild.checked},d=d.children[4].firstChild,d.hasAttribute("data-nocolor")||(e.color=d.style.backgroundColor),b.push(e);b[0]?localStorage.setItem("4chan-filters",JSON.stringify(b)):localStorage.removeItem("4chan-filters")},getNextFilterId:function(){var a,b,c,d=$.id("filter-list").children;if(d.length){for(a=c=0;b=d[a];++a)b=+b.id.slice(7),b>c&&(c=b);return c+1}return 0},buildEntry:function(a,b){var c,d,e;c=document.createElement("tr");c.id="filter-"+b;d='<td><span data-cmd="filters-up" class="pointer">&uarr;</span></td><td><input type="checkbox"'+(a.active?' checked="checked"></td>':"></td>");d+='<td><input class="fPattern" type="text" value="'+
a.pattern.replace(/"/g,"&quot;")+'"></td>';e="     ".split(" ");e[a.type]=' selected="selected"';d+='<td><select size="1"><option value="0"'+e[0]+'>Tripcode</option><option value="1"'+e[1]+'>Name</option><option value="2"'+e[2]+'>Comment</option><option value="3"'+e[3]+'>E-mail</option><option value="4"'+e[4]+'>ID</option><option value="5"'+e[5]+">Subject</option></select></td>";d+='<td><span data-cmd="filters-palette" title="Change Color" class="colorbox fColor" ';d=a.color?d+(' style="background-color:'+
a.color+'">'):d+' data-nocolor="1">&#x2215;';d+="</span></td>";d+='<td><input type="checkbox"'+(a.hide?' checked="checked"></td>':"></td>");d+='<td><span data-cmd="filters-del" class="pointer fDel">&times;</span></td>';c.innerHTML=d;return c},buildPalette:function(a){var b,c,d,e,f,g;e=[["#E0B0FF","#F2F3F4","#7DF9FF","#FFFF00"],["#FBCEB1","#FFBF00","#ADFF2F","#0047AB"],["#00A550","#007FFF","#AF0A0F","#B5BD68"]];f=e.length;g=e[0].length;d='<div id="colorpicker" class="reply extPanel"><table><tbody>';for(b=0;b<f;++b){d+="<tr>";for(c=0;c<g;++c)d+='<td><div data-cmd="palette-pick" class="colorbox" style="background:'+e[b][c]+'"></div></td>';d+="</tr>"}d+='</tbody></table>Custom<div id="palette-custom"><input id="palette-custom-input" type="text"><div id="palette-custom-ok" data-cmd="palette-pick" title="Select Color" class="colorbox"></div></div>[<a href="javascript:;" data-cmd="palette-close">Close</a>][<a href="javascript:;" data-cmd="palette-clear">Clear</a>]</div>';b=document.createElement("div");b.id="filter-palette";b.setAttribute("data-target",a);b.setAttribute("data-cmd","palette-close");b.className="UIMenu";b.innerHTML=d;return b},openPalette:function(a){var b;Filter.closePalette();b=a.getBoundingClientRect();a=a.parentNode.parentNode.id.slice(7);a=Filter.buildPalette(a);document.body.appendChild(a);$.id("filter-palette").addEventListener("click",Filter.onPaletteClick,!1);$.id("palette-custom-input").addEventListener("keyup",Filter.setCustomColor,!1);a=a.firstElementChild;a.style.cssText="top:"+b.top+"px;left:"+(b.left-a.clientWidth-10)+"px;"},closePalette:function(){var a;if(a=$.id("filter-palette"))$.id("filter-palette").removeEventListener("click",Filter.onPaletteClick,!1),$.id("palette-custom-input").removeEventListener("keyup",Filter.setCustomColor,!1),a.parentNode.removeChild(a)},pickColor:function(a,b){var c;c=$.id("filter-palette").getAttribute("data-target");if(c=$.id("filter-"+c))c=$.cls("colorbox",c)[0],!0===b?(c.setAttribute("data-nocolor","1"),c.innerHTML="&#x2215;",c.style.background=""):(c.removeAttribute("data-nocolor"),c.innerHTML="",c.style.background=a.style.backgroundColor),Filter.closePalette()},setCustomColor:function(){var a;a=$.id("palette-custom-input");$.id("palette-custom-ok").style.backgroundColor=a.value}},IDColor={css:"padding: 0 5px; border-radius: 6px; font-size: 0.8em;",boards:{q:!0,b:!0,soc:!0},ids:{},init:function(){var a;this.boards[Main.board]&&(this.enabled=!0,a=document.createElement("style"),a.setAttribute("type","text/css"),a.textContent=".posteruid .hand {"+this.css+"}",document.head.appendChild(a))},compute:function(a){var b,c;b=[];c=$.hash(a);b[0]=c>>24&255;b[1]=c>>16&255;b[2]=c>>8&255;b[3]=125<0.299*b[0]+0.587*b[1]+0.114*b[2];return this.ids[a]=b},apply:function(a){var b;b=IDColor.ids[a.textContent]||IDColor.compute(a.textContent);a.style.cssText="background-color: rgb("+b[0]+","+b[1]+","+b[2]+");color: "+(b[3]?"black;":"white;")},applyRemote:function(a){this.apply(a);a.style.cssText+=this.css}},Media={init:function(){this.matchSC=/(?:soundcloud\.com|snd\.sc)\/[^\s<]+(?:<wbr>)?[^\s<]*/g;this.matchYT=/(?:youtube\.com\/watch\?[^\s]*?v=|youtu\.be\/)[^\s<]+(?:<wbr>)?[^\s<]*(?:<wbr>)?[^\s<]*/g;this.toggleYT=/(?:v=|\.be\/)([a-zA-Z0-9_-]{11})/;this.timeYT=/#t=([ms0-9]+)]/},parseSoundCloud:function(a){a.innerHTML=a.innerHTML.replace(this.matchSC,this.replaceSoundCloud)},replaceSoundCloud:function(a){return"<span>"+a+'</span> [<a href="javascript:;" data-cmd="embed" data-type="sc">Embed</a>]'},toggleSoundCloud:function(a){var b,c;"Remove"==a.textContent?(a.parentNode.removeChild(a.nextElementSibling),a.textContent="Embed"):"Embed"==a.textContent&&(c=a.previousElementSibling.textContent,b=new XMLHttpRequest,b.open("GET","//soundcloud.com/oembed?show_artwork=false&maxwidth=500px&show_comments=false&format=json&url=http://"+c),b.onload=function(){var b;200==this.status||304==this.status?(b=document.createElement("div"),b.className="media-embed",b.innerHTML=JSON.parse(this.responseText).html,a.parentNode.insertBefore(b,a.nextElementSibling),a.textContent="Remove"):(a.textContent="Error",console.log("SoundCloud Error (HTTP "+this.status+")"))},a.textContent="Loading...",b.send(null))},parseYouTube:function(a){a.innerHTML=a.innerHTML.replace(this.matchYT,this.replaceYouTube)},replaceYouTube:function(a){return"<span>"+a+'</span> [<a href="javascript:;" data-cmd="embed" data-type="yt">Embed</a>]'},toggleYouTube:function(a){var b,c;if("Remove"==a.textContent)a.parentNode.removeChild(a.nextElementSibling),a.textContent="Embed";else if(c=a.previousElementSibling.textContent,b=c.match(this.toggleYT),c=c.match(this.timeYT),b&&(b=b[1])){b=encodeURIComponent(b);if(c&&(c=c[1]))b+="#t="+encodeURIComponent(c);c=document.createElement("div");c.className="media-embed";c.innerHTML='<iframe src="//www.youtube.com/embed/'+b+'" width="640" height="360" frameborder="0"></iframe>';a.parentNode.insertBefore(c,a.nextElementSibling);a.textContent="Remove"}else a.textContent="Error"},toggleEmbed:function(a){"yt"==a.getAttribute("data-type")?Media.toggleYouTube(a):Media.toggleSoundCloud(a)}},CustomCSS={init:function(){var a,b;if(b=localStorage.getItem("4chan-css"))a=document.createElement("style"),a.id="customCSS",a.setAttribute("type","text/css"),a.textContent=b,document.head.appendChild(a)},open:function(){var a;$.id("customCSSMenu")||(a=document.createElement("div"),a.id="customCSSMenu",a.className="UIPanel",a.setAttribute("data-cmd","css-close"),a.innerHTML='<div class="extPanel reply"><div class="panelHeader">Custom CSS<span><img alt="Close" title="Close" class="pointer" data-cmd="css-close" src="'+
Main.icons.cross+'"></span></div><textarea id="customCSSBox">'+(localStorage.getItem("4chan-css")||"")+'</textarea><div class="center"><button data-cmd="css-save">Save CSS</button></div></td></tr></tfoot></table></div>',document.body.appendChild(a),a.addEventListener("click",this.onClick,!1),$.id("customCSSBox").focus())},save:function(){var a,b;if(a=$.id("customCSSBox"))if(localStorage.setItem("4chan-css",a.value),Config.customCSS&&(b=$.id("customCSS")))document.head.removeChild(b),CustomCSS.init()},close:function(){var a;if(a=$.id("customCSSMenu"))a.removeEventListener("click",this.onClick,!1),document.body.removeChild(a)},onClick:function(a){if(a=a.target.getAttribute("data-cmd"))switch(a){case"css-close":CustomCSS.close();break;case"css-save":CustomCSS.save(),CustomCSS.close()}}},Keybinds={init:function(){this.map={65:function(){ThreadUpdater.enabled&&ThreadUpdater.toggleAuto()},70:function(){Config.filter&&Filter.addSelection()},81:function(){QR.enabled&&Main.tid&&QR.quotePost(Main.tid)},82:function(){ThreadUpdater.enabled&&ThreadUpdater.forceUpdate()},87:function(){Config.threadWatcher&&Main.tid&&ThreadWatcher.toggle(Main.tid)},66:function(){var a;(a=$.cls("prev")[0])&&(a=$.tag("form",a)[0])&&a.submit()},67:function(){location.href="/"+Main.board+"/catalog"},78:function(){var a;(a=$.cls("next")[0])&&(a=$.tag("form",a)[0])&&a.submit()},73:function(){location.href="/"+Main.board+"/"}};document.addEventListener("keydown",this.resolve,!1)},resolve:function(a){var b;b=a.target;if(!("TEXTAREA"==b.nodeName||"INPUT"==b.nodeName))if((b=Keybinds.map[a.keyCode])&&!a.altKey&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey)a.preventDefault(),a.stopPropagation(),b()},open:function(){var a;$.id("keybindsHelp")||(a=document.createElement("div"),a.id="keybindsHelp",a.className="UIPanel",a.setAttribute("data-cmd","keybinds-close"),a.innerHTML='<div class="extPanel reply"><div class="panelHeader">Keyboard Shortcuts<span><img data-cmd="keybinds-close" class="pointer" alt="Close" title="Close" src="'+Main.icons.cross+'"></span></div><ul><li><strong>Global</strong></li><li><kbd>A</kbd> &mdash; Toggle auto-updater</li><li><kbd>Q</kbd> &mdash; Open Quick Reply</li><li><kbd>R</kbd> &mdash; Update thread</li><li><kbd>W</kbd> &mdash; Watch/Unwatch thread</li><li><kbd>B</kbd> &mdash; Previous page</li><li><kbd>N</kbd> &mdash; Next page</li><li><kbd>I</kbd> &mdash; Return to index</li><li><kbd>C</kbd> &mdash; Open catalog</li><li><kbd>F</kbd> &mdash; Filter selected text</li></ul><ul><li><strong>Quick Reply (always enabled)</strong></li><li><kbd>Ctrl + Click</kbd> the post number &mdash; Quote without linking</li><li><kbd>Ctrl + S</kbd> &mdash; Spoiler tags</li><li><kbd>Esc</kbd> &mdash; Close the Quick Reply</li></ul>',document.body.appendChild(a),a.addEventListener("click",this.onClick,!1))},close:function(){var a;if(a=$.id("keybindsHelp"))a.removeEventListener("click",this.onClick,!1),document.body.removeChild(a)},onClick:function(a){var b;(b=a.target.getAttribute("data-cmd"))&&"keybinds-close"==b&&Keybinds.close()}},Report={onDone:function(a){"https://sys.4chan.org"===a.origin&&/^done-report/.test(a.data)&&(Report.cnt&&Report.close(),a=a.data.split("-")[2],Config.threadHiding&&$.id("t"+a)?ThreadHiding.isHidden(a)||(ThreadHiding.hide(a),ThreadHiding.save()):Config.replyHiding&&$.id("p"+a)&&!ReplyHiding.isHidden(a)&&(ReplyHiding.hide(a),ReplyHiding.save()))},open:function(a){Config.inlineReport?this.openInline(a):this.openPopup(a)},openPopup:function(a){window.open("https://sys.4chan.org/"+Main.board+"/imgboard.php?mode=report&no="+a,Date.now(),"toolbar=0,scrollbars=0,location=0,status=1,menubar=0,resizable=1,width=600,height=170")},openInline:function(a){this.cnt&&this.close();this.cnt=document.createElement("div");this.cnt.id="quickReport";this.cnt.className="extPanel reply";this.cnt.setAttribute("data-trackpos","QRep-position");Config["QRep-position"]?this.cnt.style.cssText=Config["QRep-position"]:(this.cnt.style.right="0px",this.cnt.style.top="50px");this.cnt.innerHTML='<div id="qrepHeader" class="drag postblock">Report Post No.'+a+'<img alt="X" src="'+Main.icons.cross+'" id="qrepClose" class="extButton" title="Close Window"></div><iframe src="https://sys.4chan.org/'+Main.board+"/imgboard.php?mode=report&no="+
a+'" width="610" height="170" frameborder="0"></iframe>';document.body.appendChild(this.cnt);window.addEventListener("message",Report.onDone,!1);document.addEventListener("keydown",Report.onKeyDown,!1);$.id("qrepClose").addEventListener("click",Report.close,!1);Draggable.set($.id("qrepHeader"))},close:function(){window.removeEventListener("message",Report.onDone,!1);document.removeEventListener("keydown",Report.onKeyDown,!1);Draggable.unset($.id("qrepHeader"));$.id("qrepClose").removeEventListener("click",Report.close,!1);document.body.removeChild(Report.cnt);Report.cnt=null},onKeyDown:function(a){27==a.keyCode&&(!a.ctrlKey&&!a.altKey&&!a.shiftKey&&!a.metaKey)&&Report.close()}},Draggable={el:null,key:null,scrollX:null,scrollY:null,dx:null,dy:null,right:null,bottom:null,set:function(a){a.addEventListener("mousedown",Draggable.startDrag,!1)},unset:function(a){a.removeEventListener("mousedown",Draggable.startDrag,!1)},startDrag:function(a){var b,c,d;if(!this.parentNode.hasAttribute("data-shiftkey")||a.shiftKey)a.preventDefault(),b=Draggable,c=document.documentElement,b.el=this.parentNode,b.key=b.el.getAttribute("data-trackpos"),d=b.el.getBoundingClientRect(),b.dx=a.clientX-d.left,b.dy=a.clientY-d.top,b.right=c.clientWidth-d.width,b.bottom=c.clientHeight-d.height,"fixed"!=getComputedStyle(b.el,null).position?(b.scrollX=window.pageXOffset,b.scrollY=window.pageYOffset):b.scrollX=b.scrollY=0,document.addEventListener("mouseup",b.endDrag,!1),document.addEventListener("mousemove",b.onDrag,!1)},endDrag:function(){document.removeEventListener("mouseup",Draggable.endDrag,!1);document.removeEventListener("mousemove",Draggable.onDrag,!1);Draggable.key&&(Config[Draggable.key]=Draggable.el.style.cssText,Config.save());delete Draggable.el},onDrag:function(a){var b,c;b=a.clientX-Draggable.dx+Draggable.scrollX;a=a.clientY-Draggable.dy+Draggable.scrollY;c=Draggable.el.style;1>b?(c.left="0",c.right=""):Draggable.right<b?(c.left="",c.right="0"):(c.left=100*(b/document.documentElement.clientWidth)+"%",c.right="");1>a?(c.top="0",c.bottom=""):Draggable.bottom<a?(c.bottom="0",c.top=""):(c.top=100*(a/document.documentElement.clientHeight)+"%",c.bottom="")}},UA={init:function(){document.head=document.head||$.tag("head")[0];this.isOpera="[object Opera]"==Object.prototype.toString.call(window.opera);this.isWebKit=/WebKit/.test(navigator.userAgent);this.hasCORS="withCredentials"in new XMLHttpRequest;this.hasFormData="FormData"in window;this.hasDragAndDrop=!1},dispatchEvent:function(a,b){var c=document.createEvent("Event");c.initEvent(a,!1,!1);b&&(c.detail=b);document.dispatchEvent(c)},getSelection:function(a){var b;if(!(UA.isOpera&&"string"==typeof(b=document.getSelection())))b=window.getSelection(),a||(b=b.toString());return b}},Config={quotePreview:!0,backlinks:!0,quickReply:!0,threadUpdater:!0,threadHiding:!0,pageTitle:!0,hideGlobalMsg:!0,alwaysAutoUpdate:!1,topPageNav:!1,threadWatcher:!1,imageExpansion:!1,fitToScreenExpansion:!1,threadExpansion:!1,alwaysDepage:!1,imageSearch:!1,reportButton:!1,localTime:!1,stickyNav:!1,keyBinds:!1,inlineQuotes:!1,filter:!1,revealSpoilers:!1,replyHiding:!1,imageHover:!1,threadStats:!1,IDColor:!1,downloadFile:!1,inlineReport:!1,noPictures:!1,embedYouTube:!1,embedSoundCloud:!1,updaterSound:!1,customCSS:!1,autoScroll:!1,hideStubs:!1,compactThreads:!1,dropDownNav:!1,fixedThreadWatcher:!1,persistentQR:!1,disableAll:!1,load:function(){(storage=localStorage.getItem("4chan-settings"))?(storage=JSON.parse(storage),$.extend(Config,storage)):Main.firstRun=!0},loadFromURL:function(){var a,b;a=location.href.split("=",2);if(/#cfg$/.test(a[0]))try{return b=JSON.parse(decodeURIComponent(a[1])),console.log(b),history.replaceState(null,"",location.href.split("#",1)[0]),$.extend(Config,JSON.parse(b.settings)),Config.save(),b.filters&&localStorage.setItem("4chan-filters",b.filters),b.css&&localStorage.setItem("4chan-css",b.css),b.catalogFilters&&localStorage.setItem("catalog-filters",b.catalogFilters),b.catalogSettings&&localStorage.setItem("catalog-settings",b.catalogSettings),!0}catch(c){console.log(c)}return!1},toURL:function(){var a,b={};b.settings=localStorage.getItem("4chan-settings");if(a=localStorage.getItem("4chan-filters"))b.filters=a;if(a=localStorage.getItem("4chan-css"))b.css=a;if(a=localStorage.getItem("catalog-filters"))b.catalogFilters=a;if(a=localStorage.getItem("catalog-settings"))b.catalogSettings=a;return encodeURIComponent(JSON.stringify(b))},save:function(){localStorage.setItem("4chan-settings",JSON.stringify(Config))}},SettingsMenu={options:{Quotes:{quotePreview:["Quote preview","Enable inline quote previews",!0],backlinks:["Backlinks","Show who has replied to a post"],inlineQuotes:["Inline quote links","Clicking quote links will inline expand the quoted post, shift-clicking bypasses the inlining"]},Posting:{quickReply:["Quick reply","Enable inline reply box",!0],persistentQR:["Persistent quick reply","Keep quick reply window open after posting"]},Monitoring:{threadUpdater:["Thread updater","Enable inline thread updating",!0],alwaysAutoUpdate:["Auto-update by default","Always auto-update threads",!0],autoScroll:["Auto-scroll with auto-updated posts","Automatically scroll the page as new posts are added"],updaterSound:["Sound notification","Play a sound when somebody replies to your posts"],threadWatcher:["Thread watcher","Enable thread watcher"],fixedThreadWatcher:["Pin thread watcher","Pin the thread watcher to the page"],threadStats:["Thread statistics","Display post and image counts at the top and bottom right of the page"],pageTitle:["Excerpts in page title","Show post subjects or comment excerpts in page title"]},Filtering:{filter:['Filters &amp; Highlights [<a href="javascript:;" data-cmd="filters-open">Edit</a>]',"Enable pattern-based filters"],threadHiding:['Thread hiding [<a href="javascript:;" data-cmd="thread-hiding-clear">Clear</a>]',"Enable thread hiding",!0],replyHiding:["Reply hiding","Enable reply hiding"],hideStubs:["Hide thread stubs","Don't display stubs of hidden threads"]},Images:{imageExpansion:["Image expansion","Enable inline image expansion, limited to browser width",!0],fitToScreenExpansion:["Fit expanded images to screen","Limit expanded images to both browser width and height"],imageHover:["Image hover","Expand images on hover, limited to browser size"],imageSearch:["Image search","Add Google and iqdb image search buttons next to image posts"],downloadFile:["Download original","Adds a button to download image with original filename (Chrome only)"],revealSpoilers:["Don't spoiler images","Don't replace spoiler images with a placeholder and show filenames"],noPictures:["Hide thumbnails","Don't display thumbnails while browsing",!0]},Navigation:{threadExpansion:["Thread expansion","Enable inline thread expansion",!0],alwaysDepage:["Always use infinite scroll","Enable infinite scroll by default, so reaching the bottom of the board index will load subsequent pages"],topPageNav:["Page navigation at top of page","Show the page switcher at the top of the page, hold Shift and drag to move"],dropDownNav:["Use drop-down navigation","Use persistent drop-down navigation bar instead of traditional links"],stickyNav:["Navigation arrows","Show top and bottom navigation arrows, hold Shift and drag to move"],keyBinds:['Use keyboard shortcuts [<a href="javascript:;" data-cmd="keybinds-open">Show</a>]',"Enable handy keyboard shortcuts for common actions"]},Media:{embedYouTube:["Embed YouTube links","Embed YouTube player into replies"],embedSoundCloud:["Embed SoundCloud links","Embed SoundCloud player into replies"]},Other:{customCSS:['Custom CSS [<a href="javascript:;" data-cmd="css-open">Edit</a>]',"Embed your own CSS rules",!0],hideGlobalMsg:["Enable announcement hiding","Enable announcement hiding (will reset on new or updated announcements)"],IDColor:["Color user IDs","Assign unique colors to user IDs on boards that use them"],compactThreads:["Force long posts to wrap","Long posts will wrap at 75% screen width"],reportButton:["Report button","Add a report button next to posts for easy reporting",1],inlineReport:["Inline report panel","Open report panel in browser window, instead of a popup"],localTime:["Convert dates to local time","Convert 4chan server time (US Eastern Time) to your local time"]}},presets:{Essential:{quotePreview:1,backlinks:1,quickReply:1,threadUpdater:1,threadHiding:1,pageTitle:1,hideGlobalMsg:1},Recommended:{quotePreview:1,backlinks:1,quickReply:1,threadUpdater:1,threadHiding:1,pageTitle:1,hideGlobalMsg:1,topPageNav:1,threadWatcher:1,imageExpansion:1,threadExpansion:1,imageSearch:1,reportButton:1,localTime:1,topPageNav:1,stickyNav:1,keyBinds:1},Advanced:{topPageNav:1,quotePreview:1,backlinks:1,quickReply:1,threadUpdater:1,threadHiding:1,pageTitle:1,hideGlobalMsg:1,topPageNav:1,threadWatcher:1,imageExpansion:1,threadExpansion:1,alwaysDepage:1,imageSearch:1,reportButton:1,localTime:1,topPageNav:1,stickyNav:1,keyBinds:1,filter:1,revealSpoilers:1,replyHiding:1,inlineQuotes:1,imageHover:1,threadStats:1,IDColor:1,downloadFile:1,inlineReport:1,embedYouTube:1,embedSoundCloud:1}},save:function(){var a,b,c,d;b=$.id("settingsMenu").getElementsByClassName("menuOption");for(a=0;c=b[a];++a)d=c.getAttribute("data-option"),Config[d]="checkbox"==c.type?c.checked:c.value;Config.save();SettingsMenu.close();location.href=location.href.replace(/#.+$/,"")},toggle:function(){$.id("settingsMenu")?SettingsMenu.close():SettingsMenu.open()},open:function(){var a,b,c,d,e,f,g,h,k;Main.firstRun&&((k=$.id("settingsTip"))&&k.parentNode.removeChild(k),(k=$.id("settingsTipBottom"))&&k.parentNode.removeChild(k),Config.save());f=document.createElement("div");f.id="settingsMenu";f.className="UIPanel";e='<div class="extPanel reply"><div class="panelHeader">Settings<span><img alt="Close" title="Close" class="pointer" data-cmd="settings-toggle" src="'+
Main.icons.cross+'"></a></span></div><ul>';if(Main.hasMobileLayout)for(b in c={},SettingsMenu.options){h={};g=SettingsMenu.options[b];for(d in g)g[d][2]&&(h[d]=g[d]);for(a in h){c[b]=h;break}}else{e+='<ul><li class="settings-cat">Presets <select id="settings-presets" size="1">';c=SettingsMenu.presets;for(b in c)e+='<option value="'+b+'">'+b+"</option>";e+="</select></li></ul>";c=SettingsMenu.options}for(b in c){g=c[b];e+='<ul><li class="settings-cat">'+b+"</li>";for(d in g)e+="<li><label"+(g[d][1]?' title="'+g[d][1]+'">':">")+'<input type="checkbox" class="menuOption" data-option="'+d+'"'+(Config[d]?' checked="checked">':">")+g[d][0]+"</label></li>";e+="</ul>"}e+='</ul><ul><li><label title="Completely disable the extension (overrides any checked boxes)"><input type="checkbox" class="menuOption" data-option="disableAll"'+(Config.disableAll?' checked="checked">':">")+'Disable the extension</label></li></ul><div class="center"><button data-cmd="settings-export">Export</button><button data-cmd="settings-save">Save</button></div>';f.innerHTML=e;f.addEventListener("click",SettingsMenu.onClick,!1);document.body.appendChild(f);SettingsMenu.matchPreset();$.id("settings-presets").addEventListener("change",SettingsMenu.onPresetChange,!1);(k=$.cls("menuOption",f)[0])&&k.focus()},matchPreset:function(){var a,b,c,d,e,f,g,h;f=$.cls("menuOption",$.id("settingsMenu"));g=b=-1;for(e in this.presets){++b;h=!1;d=this.presets[e];for(a=0;c=f[a];++a)if(!!d[c.getAttribute("data-option")]!=c.checked){h=!0;break}h||(g=b)}a=$.id("settings-presets");(c=$.id("custom-set"))&&a.removeChild(c);-1==g?(c=document.createElement("option"),c.id="custom-set",c.textContent="Custom",a.appendChild(c),a.selectedIndex=a.options.length-1):a.selectedIndex=g;return g},showExport:function(){var a,b;$.id("exportSettings")||(b=location.href.replace(location.hash,"")+"#cfg="+Config.toURL(),a=document.createElement("div"),a.id="exportSettings",a.className="UIPanel",a.setAttribute("data-cmd","export-close"),a.innerHTML='<div class="extPanel reply"><div class="panelHeader">Export Settings<span><img data-cmd="export-close" class="pointer" alt="Close" title="Close" src="'+
Main.icons.cross+'"></span></div><p class="center">Copy and save the URL below, and visit it from another browser or computer to restore your extension and catalog settings.</p><p class="center"><input class="export-field" type="text" readonly="readonly" value="'+b+'"></p><p style="margin-top:15px" class="center">Alternatively, you can drag the link below into your bookmarks bar and click it to restore.</p><p class="center">[<a target="_blank" href="'+b+'">Restore 4chan Settings</a>]</p>',document.body.appendChild(a),a.addEventListener("click",this.onExportClick,!1),a=$.cls("export-field",a)[0],a.focus(),a.select())},closeExport:function(){var a;if(a=$.id("exportSettings"))a.removeEventListener("click",this.onExportClick,!1),document.body.removeChild(a)},onExportClick:function(a){"exportSettings"==a.target.id&&(a.preventDefault(),a.stopPropagation(),SettingsMenu.closeExport())},onPresetChange:function(){var a,b,c,d;(a=$.id("custom-set"))&&a.parentNode.removeChild(a);a=$.id("settings-presets");b=a.options[a.selectedIndex].value;c=$.cls("menuOption");for(a=0;d=c[a];++a)d.checked=!!SettingsMenu.presets[b][d.getAttribute("data-option")]},onClick:function(a){var b,c;c=a.target;if($.hasClass(c,"menuOption"))SettingsMenu.matchPreset();else if("settingsMenu"==c.id&&(b=$.id("settingsMenu")))a.preventDefault(),a.stopPropagation(),SettingsMenu.close(b)},close:function(a){if(a=a||$.id("settingsMenu"))a.removeEventListener("click",SettingsMenu.onClick,!1),Main.hasMobileLayout||$.id("settings-presets").removeEventListener("change",SettingsMenu.onPresetChange,!1),document.body.removeChild(a)}},Main={init:function(){var a;document.addEventListener("DOMContentLoaded",Main.run,!1);Main.now=Date.now();UA.init();Config.load();Main.firstRun&&Config.loadFromURL()&&(Main.firstRun=!1);Main.stylesheet=(Main.stylesheet=Main.getCookie(style_group))?Main.stylesheet.toLowerCase().replace(/ /g,"_"):"nws_style"==style_group?"yotsuba_new":"yotsuba_b_new";Main.passEnabled=Main.getCookie("pass_enabled");QR.noCaptcha=QR.noCaptcha||Main.passEnabled;Main.initIcons();Main.addCSS();Main.type=style_group.split("_")[0];a=location.pathname.split(/\//);Main.board=a[1];Main.page=a[2];Main.tid=a[3];Config.IDColor&&IDColor.init();Config.customCSS&&CustomCSS.init();Config.keyBinds&&Keybinds.init();UA.dispatchEvent("4chanMainInit")},run:function(){var a;document.removeEventListener("DOMContentLoaded",Main.run,!1);document.addEventListener("click",Main.onclick,!1);$.id("settingsWindowLink").addEventListener("click",SettingsMenu.toggle,!1);$.id("settingsWindowLinkBot").addEventListener("click",SettingsMenu.toggle,!1);$.id("settingsWindowLinkMobile").addEventListener("click",SettingsMenu.toggle,!1);if(!Config.disableAll){Main.hasMobileLayout=(el=$.id("refresh_top"))&&0<el.offsetWidth;Main.isMobileDevice=/Mobile|Android|Dolfin|Opera Mobi|PlayStation Vita|Nintendo DS/.test(navigator.userAgent);Main.firstRun&&Main.isMobileDevice&&(Config.topPageNav=!1,Config.dropDownNav=!0);if(Config.dropDownNav&&!Main.hasMobileLayout)$.id("boardNavDesktop").style.display="none",$.id("boardNavDesktopFoot").style.display="none",$.removeClass($.id("boardNavMobile"),"mobile"),$.addClass(document.body,"hasDropDownNav");else if(Main.firstRun)Main.onFirstRun();$.addClass(document.body,Main.stylesheet);$.addClass(document.body,Main.type);Config.compactThreads&&$.addClass(document.body,"compact");Config.noPictures&&$.addClass(document.body,"noPictures");if(Config.quotePreview||Config.imageHover||Config.filter)a=$.id("delform"),a.addEventListener("mouseover",Main.onThreadMouseOver,!1),a.addEventListener("mouseout",Main.onThreadMouseOut,!1);Config.hideGlobalMsg&&Main.initGlobalMessage();Config.stickyNav&&Main.setStickyNav();Config.threadExpansion&&ThreadExpansion.init();Config.threadWatcher&&ThreadWatcher.init();Config.filter&&Filter.init();(Config.embedSoundCloud||Config.embedYouTube)&&Media.init();Config.replyHiding&&ReplyHiding.init();Config.quotePreview&&QuotePreview.init();Parser.init();Main.tid?(Main.threadClosed=!document.forms.post,Main.threadSticky=!!$.cls("stickyIcon",$.id("pi"+Main.tid))[0],Config.threadStats&&ThreadStats.init(),Config.pageTitle&&Main.setTitle(),Parser.parseThread(Main.tid),Config.threadUpdater&&ThreadUpdater.init()):(Main.page||Depager.init(),Main.addCatalogTooltip(),Config.topPageNav&&Main.setPageNav(),Config.threadHiding?(ThreadHiding.init(),Parser.parseBoard(),ThreadHiding.purge()):Parser.parseBoard());Config.quickReply&&QR.init();Config.replyHiding&&ReplyHiding.purge()}},onFirstRun:function(){var a;(a=$.id("settingsWindowLink"))&&this.addTooltip(a,null,"settingsTip");(a=$.id("settingsWindowLinkBot"))&&this.addTooltip(a,null,"settingsTipBottom")},onCatalogClick:function(){var a=this.nextElementSibling;a&&"click-me"==a.className&&(a.parentNode.removeChild(a),this.removeEventListener("mousedown",Main.onCatalogClick,!1),localStorage.setItem("catalog-visited","1"))},addCatalogTooltip:function(){var a,b,c;if(!localStorage.getItem("catalog-visited")){b=$.cls("cataloglink");for(a=0;c=b[a];++a)c=c.firstElementChild,this.addTooltip(c,"Try me!"),c.addEventListener("mousedown",Main.onCatalogClick,!1)}},addTooltip:function(a,b,c){var d;d=document.createElement("div");d.className="click-me";c&&(d.id=c);d.innerHTML=b||"Click me!";a.parentNode.appendChild(d);d.style.marginLeft=(a.offsetWidth-d.offsetWidth+a.offsetLeft-d.offsetLeft)/2+"px";return d},isThreadClosed:function(a){return(el=$.id("pi"+a))&&$.cls("closedIcon",el)[0]},setThreadState:function(a,b){var c,d,e,f;f=a.charAt(0).toUpperCase()+a.slice(1);b?(c=$.cls("postNum",$.id("pi"+Main.tid))[0],d=document.createElement("img"),d.className=a+"Icon retina",d.title=f,d.src=Main.icons2[a],"sticky"==a&&(e=$.cls("closedIcon",c)[0])?(c.insertBefore(d,e),c.insertBefore(document.createTextNode(" "),e)):(c.appendChild(document.createTextNode(" ")),c.appendChild(d))):(d=$.cls(a+"Icon",$.id("pi"+Main.tid))[0],d.parentNode.removeChild(d.previousSibling),d.parentNode.removeChild(d));Main["thread"+f]=b},icons:{up:"arrow_up.png",down:"arrow_down.png",download:"arrow_down2.png",refresh:"refresh.png",cross:"cross.png",gis:"gis.png",iqdb:"iqdb.png",minus:"post_expand_minus.png",plus:"post_expand_plus.png",rotate:"post_expand_rotate.gif",quote:"quote.png",report:"report.png",notwatched:"watch_thread_off.png",watched:"watch_thread_on.png",help:"question.png"},icons2:{closed:"closed.gif",sticky:"sticky.gif",trash:"trash.gif"},initIcons:function(){var a,b;b="//static.4chan.org/image/";if(2<=window.devicePixelRatio){for(a in Main.icons)Main.icons[a]=Main.icons[a].replace(".","@2x.");for(a in Main.icons2)Main.icons2[a]=Main.icons2[a].replace(".","@2x.")}for(a in Main.icons2)Main.icons2[a]=b+Main.icons2[a];b+="buttons/"+{yotsuba_new:"futaba/",futaba_new:"futaba/",yotsuba_b_new:"burichan/",burichan_new:"burichan/",tomorrow:"tomorrow/",photon:"photon/"}[Main.stylesheet];for(a in Main.icons)Main.icons[a]=b+Main.icons[a]},setPageNav:function(){var a,b;b=document.createElement("div");b.setAttribute("data-shiftkey","1");b.setAttribute("data-trackpos","TN-position");b.className="topPageNav";Config["TN-position"]?b.style.cssText=Config["TN-position"]:(b.style.left="10px",b.style.top="50px");a=$.cls("pagelist")[0].cloneNode(!0);b.appendChild(a);Draggable.set(a);document.body.appendChild(b)},initGlobalMessage:function(){var a,b,c,d;if((a=$.id("globalMessage"))&&a.textContent)a.nextElementSibling.style.clear="both",b=document.createElement("img"),b.id="toggleMsgBtn",b.className="extButton",b.setAttribute("data-cmd","toggleMsg"),b.alt="Toggle",b.title="Toggle announcement",d=localStorage.getItem("4chan-global-msg"),c=a.getAttribute("data-utc"),d&&c<=d?(a.style.display="none",b.style.opacity="0.5",b.src=Main.icons.plus):b.src=Main.icons.minus,a.parentNode.insertBefore(b,a)},toggleGlobalMessage:function(){var a,b;a=$.id("globalMessage");b=$.id("toggleMsgBtn");"none"==a.style.display?(a.style.display="",b.src=Main.icons.minus,b.style.opacity="1",localStorage.removeItem("4chan-global-msg")):(a.style.display="none",b.src=Main.icons.plus,b.style.opacity="0.5",localStorage.setItem("4chan-global-msg",a.getAttribute("data-utc")))},setStickyNav:function(){var a,b;a=document.createElement("div");a.id="stickyNav";a.className="extPanel reply";a.setAttribute("data-shiftkey","1");a.setAttribute("data-trackpos","SN-position");Config["SN-position"]?a.style.cssText=Config["SN-position"]:(a.style.right="10px",a.style.top="50px");b=document.createElement("div");b.innerHTML='<img class="pointer" src="'+Main.icons.up+'" data-cmd="totop" alt="\u25b2" title="Top"><img class="pointer" src="'+Main.icons.down+'" data-cmd="tobottom" alt="\u25bc" title="Bottom">';Draggable.set(b);a.appendChild(b);document.body.appendChild(a)},setTitle:function(){var a,b;if(!(a=$.cls("subject",$.id("pi"+Main.tid))[0].textContent))(a=$.id("m"+Main.tid).innerHTML)?(b=document.createElement("span"),b.innerHTML=a.replace(/<br>/g," "),a=b.textContent.slice(0,50)):a="No."+Main.tid;document.title="/"+Main.board+"/ - "+a},getCookie:function(a){var b,c,d;d=a+"=";c=document.cookie.split(";");for(a=0;b=c[a];++a){for(;" "==b.charAt(0);)b=b.substring(1,b.length);if(0==b.indexOf(d))return decodeURIComponent(b.substring(d.length,b.length))}return null},onclick:function(a){var b,c;if((b=a.target)!=document)if(c=b.getAttribute("data-cmd"))switch(id=b.getAttribute("data-id"),c){case"update":a.preventDefault();ThreadUpdater.forceUpdate();break;case"auto":ThreadUpdater.toggleAuto();break;case"totop":case"tobottom":a.shiftKey||(location.href="#"+c.slice(2));break;case"hide":ThreadHiding.toggle(id);break;case"watch":ThreadWatcher.toggle(id);break;case"hide-r":ReplyHiding.toggle(id);break;case"expand":ThreadExpansion.toggle(id);break;case"depage":a.preventDefault();Depager.toggle();break;case"report":Report.open(id);break;case"embed":Media.toggleEmbed(b);break;case"sound":ThreadUpdater.toggleSound();break;case"toggleMsg":Main.toggleGlobalMessage();break;case"settings-toggle":SettingsMenu.toggle();break;case"settings-save":SettingsMenu.save();break;case"keybinds-open":Keybinds.open();break;case"filters-open":Filter.open();break;case"thread-hiding-clear":ThreadHiding.clear();break;case"css-open":CustomCSS.open();break;case"settings-export":SettingsMenu.showExport();break;case"export-close":SettingsMenu.closeExport()}else Config.disableAll||(QR.enabled&&"Quote this post"==b.title?(a.preventDefault(),c=Main.tid||b.previousElementSibling.getAttribute("href").split("#")[0].slice(4),QR.quotePost(c,!a.ctrlKey&&b.textContent)):Config.imageExpansion&&1==a.which&&b.parentNode&&$.hasClass(b.parentNode,"fileThumb")&&"A"==b.parentNode.nodeName&&!$.hasClass(b.parentNode,"deleted")?(a.preventDefault(),ImageExpansion.toggle(b)):Config.inlineQuotes&&1==a.which&&$.hasClass(b,"quotelink")?a.shiftKey?(a.preventDefault(),location=b.href):QuoteInline.toggle(b,a):Config.threadExpansion&&b.parentNode&&$.hasClass(b.parentNode,"abbr")?(a.preventDefault(),ThreadExpansion.expandComment(b)):Main.isMobileDevice&&Config.quotePreview&&($.id("quote-preview")&&QuotePreview.remove(),$.hasClass(b,"quotelink")&&((c=b.getAttribute("href").match(QuotePreview.regex))&&"rs"!=c[1])&&a.preventDefault()))},onThreadMouseOver:function(a){var b=a.target;Config.quotePreview&&$.hasClass(b,"quotelink")&&!$.hasClass(b,"deadlink")?QuotePreview.resolve(a.target):Config.imageHover&&b.hasAttribute("data-md5")&&!$.hasClass(b.parentNode,"deleted")?ImageHover.show(b):Config.filter&&b.hasAttribute("data-filtered")&&QuotePreview.show(b,b.href?b.parentNode.parentNode.parentNode:b.parentNode.parentNode)},onThreadMouseOut:function(a){a=a.target;Config.quotePreview&&$.hasClass(a,"quotelink")?QuotePreview.remove(a):Config.imageHover&&a.hasAttribute("data-md5")?ImageHover.hide():Config.filter&&a.hasAttribute("data-filtered")&&QuotePreview.remove(a)},linkToThread:function(a,b,c){return"//"+location.host+"/"+(b||Main.board)+"/res/"+a+(0<c?"#p"+c:"")},addCSS:function(){var a;a=document.createElement("style");a.setAttribute("type","text/css");a.textContent='body.hasDropDownNav {margin-top: 50px;}.extButton.threadHideButton {float: left;margin-right: 5px;margin-top: -1px;}.extButton.replyHideButton {margin-top: 1px;}div.op > span .postHideButtonCollapsed {margin-right: 1px;}.dropDownNav #boardNavMobile, {display: block !important;}.extPanel {border: 1px solid rgba(0, 0, 0, 0.20);}.tomorrow .extPanel {border: 1px solid #111;}.extButton,img.pointer {width: 18px;height: 18px;}.extControls {display: inline;margin-left: 5px;}.extButton {cursor: pointer;margin-bottom: -4px;}.trashIcon {width: 16px;height: 16px;margin-bottom: -2px;margin-left: 5px;}.threadUpdateStatus {margin-left: 0.5ex;}.futaba_new .stub,.burichan_new .stub {line-height: 1;padding-bottom: 1px;}.stub .extControls,.stub .wbtn,.stub input {display: none;}.stub .threadHideButton {float: none;margin-right: 2px;}div.post div.postInfo {width: auto;display: inline;}.right {float: right;}.center {display: block;margin: auto;}.pointer {cursor: pointer;}.drag {cursor: move !important;user-select: none !important;-moz-user-select: none !important;-webkit-user-select: none !important;}#quickReport,#quickReply {display: block;position: fixed;padding: 2px;font-size: 10pt;}#qrepHeader,#qrHeader {text-align: center;margin-bottom: 1px;padding: 0;height: 18px;line-height: 18px;}#qrepClose,#qrClose {float: right;}#quickReport iframe {overflow: hidden;}#quickReport {height: 190px;}#qrForm > div {clear: both;}#quickReply input[type="text"],#quickReply textarea,#quickReply #recaptcha_response_field {border: 1px solid #aaa;font-family: arial,helvetica,sans-serif;font-size: 10pt;outline: medium none;width: 296px;padding: 2px;margin: 0 0 1px 0;}#quickReply textarea {min-width: 296px;float: left;}#quickReply input::-moz-placeholder,#quickReply textarea::-moz-placeholder {color: #aaa !important;opacity: 1 !important;}#quickReply input[type="submit"] {width: 83px;margin: 0;font-size: 10pt;float: left;}#quickReply #qrCapField {display: block;margin-top: 1px;}#qrCaptcha {width: 300px;height: 53px;cursor: pointer;border: 1px solid #aaa;display: block;}#quickReply input.presubmit {margin-right: 1px;width: 212px;float: left;}#qrFile {width: 215px;margin-right: 5px;}.qrRealFile {position: absolute;left: 0;visibility: hidden;}.yotsuba_new #qrFile {color:black;}#qrSpoiler {display: inline;}#qrError {width: 292px;display: none;font-family: monospace;background-color: #E62020;font-size: 12px;color: white;padding: 3px 5px;text-shadow: 0 1px rgba(0, 0, 0, 0.20);clear: both;}#qrError a:hover,#qrError a {color: white !important;}#twHeader {font-weight: bold;text-align: center;height: 17px;}.futaba_new #twHeader,.burichan_new #twHeader {line-height: 1;}#twPrune {margin-left: 3px;margin-top: -1px;}#threadWatcher {max-width: 265px;display: block;position: absolute;padding: 3px;}#watchList {margin: 0;padding: 0;user-select: none;-moz-user-select: none;-webkit-user-select: none;}#watchList li:first-child {margin-top: 3px;padding-top: 2px;border-top: 1px solid rgba(0, 0, 0, 0.20);}.photon #watchList li:first-child {border-top: 1px solid #ccc;}.yotsuba_new #watchList li:first-child {border-top: 1px solid #d9bfb7;}.yotsuba_b_new #watchList li:first-child {border-top: 1px solid #b7c5d9;}.tomorrow #watchList li:first-child {border-top: 1px solid #111;}#watchList a {text-decoration: none;}#watchList li {overflow: hidden;white-space: nowrap;text-overflow: ellipsis;}div.post div.image-expanded {display: table;}div.op div.file .image-expanded-anti {margin-left: -3px;}#quote-preview {display: block;position: absolute;padding: 3px 6px 6px 3px;margin: 0;}#quote-preview .dateTime {white-space: nowrap;}.yotsuba_new #quote-preview.highlight,.yotsuba_b_new #quote-preview.highlight {border-width: 1px 2px 2px 1px !important;border-style: solid !important;}.yotsuba_new #quote-preview.highlight {border-color: #D99F91 !important;}.yotsuba_b_new #quote-preview.highlight {border-color: #BA9DBF !important;}.yotsuba_b_new .highlight-anti,.burichan_new .highlight-anti {border-width: 1px !important;background-color: #bfa6ba !important;}.yotsuba_new .highlight-anti,.futaba_new .highlight-anti {background-color: #e8a690 !important;}.tomorrow .highlight-anti {background-color: #111 !important;border-color: #111;}.photon .highlight-anti {background-color: #bbb !important;}.op.inlined {display: block;}#quote-preview .inlined,#quote-preview .extButton,#quote-preview .extControls {display: none;}.hasNewReplies {font-weight: bold;}.deadlink {text-decoration: line-through !important;}div.backlink {font-size: 0.8em !important;display: inline;padding: 0;padding-left: 5px;}.backlink span {padding: 0;}.burichan_new .backlink a,.yotsuba_b_new .backlink a {color: #34345C !important;}.expbtn {margin-right: 3px;margin-left: 2px;}.tCollapsed .rExpanded {display: none;}#stickyNav {position: fixed;font-size: 0;}#stickyNav img {vertical-align: middle;}.tu-error {color: red;}.topPageNav {position: absolute;}.yotsuba_b_new .topPageNav {border-top: 1px solid rgba(255, 255, 255, 0.25);border-left: 1px solid rgba(255, 255, 255, 0.25);}.newPostsMarker:not(#quote-preview) {box-shadow: 0 3px red;}#toggleMsgBtn {float: left;margin-bottom: 6px;}.panelHeader {font-weight: bold;font-size: 16px;text-align: center;margin-bottom: 5px;margin-top: 5px;padding-bottom: 5px;border-bottom: 1px solid rgba(0, 0, 0, 0.20);}.yotsuba_new .panelHeader {border-bottom: 1px solid #d9bfb7;}.yotsuba_b_new .panelHeader {border-bottom: 1px solid #b7c5d9;}.tomorrow .panelHeader {border-bottom: 1px solid #111;}.panelHeader span {position: absolute;right: 5px;top: 5px;}.UIMenu,.UIPanel {position: fixed;width: 100%;height: 100%;z-index: 9002;top: 0;left: 0;}.UIPanel {line-height: 14px;font-size: 14px;background-color: rgba(0, 0, 0, 0.25);}.UIPanel:after {display: inline-block;height: 100%;vertical-align: middle;content: "";}.UIPanel > div {-moz-box-sizing: border-box;box-sizing: border-box;display: inline-block;height: auto;max-height: 100%;position: relative;width: 400px;left: 50%;margin-left: -200px;overflow: auto;box-shadow: 0 0 5px rgba(0, 0, 0, 0.25);vertical-align: middle;}.extPanel input[type="text"],.extPanel textarea {border: 1px solid #AAA;outline: none;}.UIPanel .center {margin-bottom: 5px;}.UIPanel button {display: inline-block;margin-right: 5px;}.UIPanel code {background-color: #eee;color: #000000;padding: 1px 4px;font-size: 12px;}.UIPanel ul {list-style: none;padding: 0;margin: 0 0 10px;}.UIPanel .export-field {width: 385px;}#settingsMenu label input {margin-right: 5px;}.tomorrow #settingsMenu ul {border-bottom: 1px solid #282a2e;}.settings-cat {font-weight: bold;margin: 10px 0 5px;padding-left: 5px;}#customCSSMenu textarea {display: block;max-width: 100%;min-width: 100%;-moz-box-sizing: border-box;box-sizing: border-box;height: 200px;margin: 0 0 5px;font-family: monospace;}#customCSSMenu .right,#settingsMenu .right {margin-top: 2px;}#settingsMenu label {display: inline-block;user-select: none;-moz-user-select: none;-webkit-user-select: none;}#filtersHelp > div {width: 600px;left: 50%;margin-left: -300px;}#filtersHelp h4 {font-size: 15px;margin: 20px 0 0 10px;}#filtersHelp h4:before {content: "\u00bb";margin-right: 3px;}#filtersHelp ul {padding: 0;margin: 10px;}#filtersHelp li {padding: 3px 0;list-style: none;}#filtersMenu table {width: 100%;}#filtersMenu th {font-size: 12px;}#filtersMenu tbody {text-align: center;}#filtersMenu select,#filtersMenu .fPattern,#palette-custom-input {padding: 1px;font-size: 11px;}#filtersMenu select {width: 85px;}#filtersMenu tfoot td {padding-top: 10px;}#keybindsHelp li {padding: 3px 5px;}.fPattern {width: 130px;}.fColor {width: 60px;}.fDel {font-size: 16px;}.filter-preview {cursor: default;margin-left: 3px;}#quote-preview iframe,#quote-preview .filter-preview {display: none;}.post-hidden .extButton,.post-hidden:not(#quote-preview) .postInfo {opacity: 0.5;}.post-hidden:not(.thread) .postInfo {padding-left: 5px;}.post-hidden:not(#quote-preview) input,.post-hidden:not(#quote-preview) .replyContainer,.post-hidden:not(#quote-preview) .summary,.post-hidden:not(#quote-preview) .op .file,.post-hidden:not(#quote-preview) .file,.post-hidden .wbtn,.post-hidden .postNum span,.post-hidden:not(#quote-preview) .backlink,div.post-hidden:not(#quote-preview) div.file,div.post-hidden:not(#quote-preview) blockquote.postMessage {display: none;}.click-me {border-radius: 5px;margin-top: 5px;padding: 2px 5px;position: absolute;font-weight: bold;z-index: 2;white-space: nowrap;}.yotsuba_new .click-me,.futaba_new .click-me {color: #800000;background-color: #F0E0D6;border: 2px solid #D9BFB7;}.yotsuba_b_new .click-me,.burichan_new .click-me {color: #000;background-color: #D6DAF0;border: 2px solid #B7C5D9;}.tomorrow .click-me {color: #C5C8C6;background-color: #282A2E;border: 2px solid #111;}.photon .click-me {color: #333;background-color: #ddd;border: 2px solid #ccc;}.click-me:before {content: "";border-width: 0 6px 6px;border-style: solid;left: 50%;margin-left: -6px;position: absolute;width: 0;height: 0;top: -6px;}.yotsuba_new .click-me:before,.futaba_new .click-me:before {border-color: #D9BFB7 transparent;}.yotsuba_b_new .click-me:before,.burichan_new .click-me:before {border-color: #B7C5D9 transparent;}.tomorrow .click-me:before {border-color: #111 transparent;}.photon .click-me:before {border-color: #ccc transparent;}.click-me:after {content: "";border-width: 0 4px 4px;top: -4px;display: block;left: 50%;margin-left: -4px;position: absolute;width: 0;height: 0;}.yotsuba_new .click-me:after,.futaba_new .click-me:after {border-color: #F0E0D6 transparent;border-style: solid;}.yotsuba_b_new .click-me:after,.burichan_new .click-me:after {border-color: #D6DAF0 transparent;border-style: solid;}.tomorrow .click-me:after {border-color: #282A2E transparent;border-style: solid;}.photon .click-me:after {border-color: #DDD transparent;border-style: solid;}#image-hover {position: fixed;max-width: 100%;max-height: 100%;top: 0px;right: 0px;z-index: 3;}.thread-stats {float: right;}.compact .thread {max-width: 75%;}.dotted {text-decoration: none;border-bottom: 1px dashed;}.linkfade {opacity: 0.5;}#quote-preview .linkfade {opacity: 1.0;}kbd {background-color: #f7f7f7;color: black;border: 1px solid #ccc;border-radius: 3px 3px 3px 3px;box-shadow: 0 1px 0 #ccc, 0 0 0 2px #fff inset;font-family: monospace;font-size: 11px;line-height: 1.4;padding: 0 5px;}.deleted {opacity: 0.66;}.noPictures a.fileThumb img:not(.expanded-thumb) {opacity: 0;}.noPictures.futaba_new a.fileThumb,.noPictures.yotsuba_new a.fileThumb {border: 1px solid #800;}.noPictures.burichan_new a.fileThumb,.noPictures.yotsuba_b_new a.fileThumb {border: 1px solid #34345C;}.noPictures.tomorrow a.fileThumb:not(.expanded-thumb) {border: 1px solid #C5C8C6;}.noPictures.photon a.fileThumb:not(.expanded-thumb) {border: 1px solid #004A99;}.spinner {margin-top: 2px;padding: 3px;display: table;}#settings-presets {position: relative;top: -1px;}#colorpicker { position: fixed;text-align: center;}.colorbox {font-size: 10px;width: 16px;height: 16px;line-height: 17px;display: inline-block;text-align: center;background-color: #fff;border: 1px solid #aaa;text-decoration: none;color: #000;cursor: pointer;vertical-align: top;}#palette-custom-input {vertical-align: top;width: 45px;margin-right: 2px;}#qrDummyFile {float: left;margin-right: 5px;width: 220px;cursor: default;-moz-user-select: none;-webkit-user-select: none;-ms-user-select: none;user-select: none;white-space: nowrap;text-overflow: ellipsis;overflow: hidden;}#qrDummyFileLabel {margin-left: 3px;}.depageNumber {position: absolute;right: 5px;}.depagerEnabled .depagelink {font-weight: bold;}.depagerEnabled strong {font-weight: normal;}.depagelink {display: inline-block;padding: 4px 0;cursor: pointer;text-decoration: none;}.burichan_new .depagelink,.futaba_new .depagelink {text-decoration: underline;}.customBoardList,.boardList {display: inline;}#customMenuBox {margin-bottom: 5px;width: 392px;}@media only screen and (max-width: 480px) {.image-expanded .mFileInfo {display: none !important;}.mobile-report {float: right;font-size: 11px;margin-bottom: 3px;margin-left: 10px;}.mobile-report:after {content: "]";}.mobile-report:before {content: "[";}.nws .mobile-report:after {color: #800000;}.nws .mobile-report:before {color: #800000;}.ws .mobile-report {color: #34345C;}.nws .mobile-report {color:#0000EE;}.reply .mobile-report {margin-left: 5px;margin-right: 5px;}.postLink .mobileHideButton {margin-right: 3px;}.board .mobile-hr-hidden {margin-top: 10px !important;}.board > .mobileHideButton {margin-top: -20px !important;}.board > .mobileHideButton:first-child {margin-top: 10px !important;}.extButton.threadHideButton {float: none;margin: 0;margin-bottom: 5px;}.mobile-post-hidden {display: none;}#toggleMsgBtn {display: none;}.mobile-tu-status {height: 20px;line-height: 20px;}.mobile-tu-show {width: 150px;margin: auto;display: block;text-align: center;}.button input {margin: 0 3px 0 0;position: relative;top: -2px;border-radius: 0;height: 10px;width: 10px;}.UIPanel > div {width: 320px;margin-left: -160px;}.UIPanel .export-field {width: 300px;}.yotsuba_new #quote-preview.highlight,#quote-preview {border-width: 1px !important;}.yotsuba_new #quote-preview.highlight {border-color: #D9BFB7 !important;}#quickReply input[type="text"],#quickReply textarea,.extPanel input[type="text"],.extPanel textarea {font-size: 16px;}#quickReply {position: absolute;left: 50%;margin-left: -154px;}}';document.head.appendChild(a)}};Main.init();